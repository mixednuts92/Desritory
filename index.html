<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desritory</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: #0a0b1a;
            background-image: 
                radial-gradient(ellipse at 20% 50%, rgba(88, 40, 180, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(60, 20, 140, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 80%, rgba(30, 15, 80, 0.1) 0%, transparent 50%);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            position: relative;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(150, 100, 255, 0.3);
            border-radius: 50%;
            animation: float linear infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-10vh) scale(1);
                opacity: 0;
            }
        }

        .corner-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 12px;
            z-index: 1000;
        }

        .corner-btn {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            border: 1px solid rgba(150, 100, 255, 0.2);
            background: rgba(20, 18, 40, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: rgba(180, 150, 255, 0.7);
        }

        .corner-btn:hover {
            background: rgba(100, 60, 200, 0.25);
            border-color: rgba(150, 100, 255, 0.5);
            color: rgba(200, 170, 255, 1);
            transform: scale(1.08);
            box-shadow: 0 0 25px rgba(100, 60, 200, 0.3);
        }

        .corner-btn:active {
            transform: scale(0.95);
        }

        .corner-btn svg {
            width: 22px;
            height: 22px;
            fill: currentColor;
        }

        .tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%) translateY(5px);
            background: rgba(20, 18, 40, 0.95);
            color: rgba(200, 170, 255, 0.9);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s ease;
            border: 1px solid rgba(150, 100, 255, 0.15);
        }

        .corner-btn:hover .tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 50px;
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(48px, 10vw, 100px);
            font-weight: 900;
            background: linear-gradient(135deg, #b388ff 0%, #7c4dff 25%, #a855f7 50%, #9333ea 75%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 6px;
            text-transform: uppercase;
            filter: drop-shadow(0 0 40px rgba(120, 70, 220, 0.4)) drop-shadow(0 0 80px rgba(120, 70, 220, 0.15));
            animation: logoGlow 4s ease-in-out infinite alternate;
            user-select: none;
        }

        @keyframes logoGlow {
            0% {
                filter: drop-shadow(0 0 40px rgba(120, 70, 220, 0.4)) drop-shadow(0 0 80px rgba(120, 70, 220, 0.15));
            }
            100% {
                filter: drop-shadow(0 0 60px rgba(120, 70, 220, 0.6)) drop-shadow(0 0 100px rgba(120, 70, 220, 0.25));
            }
        }

        .subtitle {
            color: rgba(180, 160, 220, 0.4);
            font-size: 14px;
            letter-spacing: 8px;
            text-transform: uppercase;
            margin-top: 10px;
            font-weight: 300;
        }

        .search-container {
            width: 100%;
            max-width: 600px;
            position: relative;
        }

        .search-wrapper {
            position: relative;
            width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 18px 60px 18px 24px;
            border-radius: 16px;
            border: 1px solid rgba(150, 100, 255, 0.15);
            background: rgba(15, 13, 35, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: #e0d4ff;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            caret-color: #a855f7;
        }

        .search-input::placeholder {
            color: rgba(150, 130, 200, 0.35);
            font-weight: 300;
        }

        .search-input:focus {
            border-color: rgba(150, 100, 255, 0.45);
            background: rgba(20, 16, 45, 0.8);
            box-shadow: 
                0 0 30px rgba(100, 60, 200, 0.15),
                0 0 60px rgba(100, 60, 200, 0.05),
                inset 0 0 30px rgba(100, 60, 200, 0.03);
        }

        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 42px;
            height: 42px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, #7c4dff, #9333ea);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-btn:hover {
            background: linear-gradient(135deg, #9366ff, #a855f7);
            box-shadow: 0 0 20px rgba(120, 70, 220, 0.4);
            transform: translateY(-50%) scale(1.05);
        }

        .search-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        .search-btn svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        .search-hint {
            text-align: center;
            margin-top: 16px;
            color: rgba(150, 130, 200, 0.3);
            font-size: 12px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 15, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal {
            background: rgba(15, 13, 35, 0.95);
            border: 1px solid rgba(150, 100, 255, 0.15);
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 30px;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            color: #c4b5fd;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: 1px solid rgba(150, 100, 255, 0.15);
            background: rgba(100, 60, 200, 0.1);
            color: rgba(180, 150, 255, 0.7);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(100, 60, 200, 0.25);
            color: #fff;
        }

        /* Settings */
        .setting-group {
            margin-bottom: 20px;
        }

        .setting-label {
            color: rgba(200, 180, 255, 0.7);
            font-size: 13px;
            margin-bottom: 8px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .setting-select, .setting-input-field {
            width: 100%;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid rgba(150, 100, 255, 0.12);
            background: rgba(10, 8, 25, 0.6);
            color: #d4c4ff;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: all 0.3s ease;
            -webkit-appearance: none;
        }

        .setting-select:focus, .setting-input-field:focus {
            border-color: rgba(150, 100, 255, 0.35);
        }

        .setting-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid rgba(150, 100, 255, 0.06);
        }

        .setting-toggle-label {
            color: rgba(200, 180, 255, 0.7);
            font-size: 14px;
        }

        .toggle-switch {
            width: 44px;
            height: 24px;
            background: rgba(60, 40, 100, 0.4);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(150, 100, 255, 0.1);
        }

        .toggle-switch.active {
            background: rgba(120, 70, 220, 0.5);
            border-color: rgba(150, 100, 255, 0.3);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: #c4b5fd;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toggle-switch.active::after {
            left: 22px;
            background: #e0d4ff;
            box-shadow: 0 0 10px rgba(150, 100, 255, 0.5);
        }

        /* Games Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 14px;
        }

        .game-card {
            background: rgba(20, 16, 45, 0.6);
            border: 1px solid rgba(150, 100, 255, 0.08);
            border-radius: 14px;
            padding: 20px 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .game-card:hover {
            background: rgba(100, 60, 200, 0.15);
            border-color: rgba(150, 100, 255, 0.25);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(100, 60, 200, 0.15);
        }

        .game-icon {
            font-size: 36px;
            margin-bottom: 10px;
            display: block;
        }

        .game-name {
            color: rgba(200, 180, 255, 0.8);
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        /* Proxy Frame */
        .proxy-frame-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3000;
            display: none;
            flex-direction: column;
            background: #0a0b1a;
        }

        .proxy-frame-container.active {
            display: flex;
        }

        .proxy-navbar {
            height: 48px;
            background: rgba(15, 13, 35, 0.95);
            border-bottom: 1px solid rgba(150, 100, 255, 0.1);
            display: flex;
            align-items: center;
            padding: 0 14px;
            gap: 10px;
            flex-shrink: 0;
        }

        .proxy-back-btn {
            width: 34px;
            height: 34px;
            border-radius: 8px;
            border: 1px solid rgba(150, 100, 255, 0.15);
            background: rgba(100, 60, 200, 0.1);
            color: rgba(180, 150, 255, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .proxy-back-btn:hover {
            background: rgba(100, 60, 200, 0.25);
        }

        .proxy-url-display {
            flex: 1;
            padding: 8px 14px;
            border-radius: 8px;
            background: rgba(10, 8, 25, 0.6);
            border: 1px solid rgba(150, 100, 255, 0.08);
            color: rgba(180, 160, 220, 0.6);
            font-size: 13px;
            font-family: 'Inter', sans-serif;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .proxy-frame {
            flex: 1;
            border: none;
            width: 100%;
            background: white;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(100, 60, 200, 0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 60, 200, 0.4);
        }

        /* Loading animation */
        .loading-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 2px;
            background: linear-gradient(90deg, #7c4dff, #a855f7, #c084fc);
            z-index: 4000;
            transition: width 0.3s ease;
            display: none;
        }

        @media (max-width: 640px) {
            .corner-buttons {
                top: 14px;
                right: 14px;
                gap: 8px;
            }

            .corner-btn {
                width: 44px;
                height: 44px;
                border-radius: 12px;
            }

            .search-input {
                padding: 16px 55px 16px 20px;
                font-size: 15px;
            }

            .search-btn {
                width: 38px;
                height: 38px;
            }

            .subtitle {
                font-size: 11px;
                letter-spacing: 5px;
            }

            .modal {
                padding: 24px;
                border-radius: 16px;
            }

            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 10px;
            }

            .game-card {
                padding: 16px 10px;
            }

            .game-icon {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>

    <div class="loading-bar" id="loadingBar"></div>

    <!-- Particles -->
    <div class="particles" id="particles"></div>

    <!-- Corner Buttons -->
    <div class="corner-buttons">
        <button class="corner-btn" id="gamesBtn" onclick="openGames()">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19c.68 0 1.32-.27 1.8-.75L9 16h6l2.25 2.25c.48.48 1.13.75 1.8.75 1.56 0 2.75-1.37 2.53-2.91zM11 11H9.5v1.5c0 .28-.22.5-.5.5s-.5-.22-.5-.5V11H7c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1.5V8.5c0-.28.22-.5.5-.5s.5.22.5.5V10H11c.28 0 .5.22.5.5s-.22.5-.5.5zm3.5-1c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm2.5 3c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
            </svg>
            <span class="tooltip">Games</span>
        </button>
        <button class="corner-btn" id="settingsBtn" onclick="openSettings()">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.488.488 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
            </svg>
            <span class="tooltip">Settings</span>
        </button>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <div class="logo-container">
            <h1 class="logo">desritory</h1>
            <p class="subtitle">explore freely</p>
        </div>

        <div class="search-container">
            <div class="search-wrapper">
                <input 
                    type="text" 
                    class="search-input" 
                    id="searchInput" 
                    placeholder="Search or enter URL..." 
                    autocomplete="off"
                    spellcheck="false"
                >
                <button class="search-btn" onclick="navigateProxy()">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                        <path d="M5 12h14" stroke="white" stroke-width="2" stroke-linecap="round" fill="none"/>
                        <path d="M13 5l6 7-6 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                    </svg>
                </button>
            </div>
            <p class="search-hint">Enter a URL or search term to browse via proxy</p>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">‚öô Settings</span>
                <button class="modal-close" onclick="closeModal('settingsModal')">‚úï</button>
            </div>

            <div class="setting-group">
                <div class="setting-label">Proxy Engine</div>
                <select class="setting-select" id="proxyEngine">
                    <option value="ultraviolet">Ultraviolet</option>
                    <option value="corrosion">Corrosion</option>
                    <option value="alloy" selected>Alloy Proxy</option>
                </select>
            </div>

            <div class="setting-group">
                <div class="setting-label">Search Engine</div>
                <select class="setting-select" id="searchEngine">
                    <option value="google" selected>Google</option>
                    <option value="bing">Bing</option>
                    <option value="duckduckgo">DuckDuckGo</option>
                    <option value="brave">Brave Search</option>
                </select>
            </div>

            <div class="setting-toggle">
                <span class="setting-toggle-label">Tab Cloaking</span>
                <div class="toggle-switch" id="tabCloak" onclick="toggleSwitch(this)"></div>
            </div>

            <div class="setting-toggle">
                <span class="setting-toggle-label">Panic Key (` key)</span>
                <div class="toggle-switch active" id="panicKey" onclick="toggleSwitch(this)"></div>
            </div>

            <div class="setting-toggle">
                <span class="setting-toggle-label">Ad Blocker</span>
                <div class="toggle-switch active" id="adBlocker" onclick="toggleSwitch(this)"></div>
            </div>

            <div class="setting-group" style="margin-top: 20px;">
                <div class="setting-label">Cloak Page Title</div>
                <input type="text" class="setting-input-field" id="cloakTitle" placeholder="e.g. Google Classroom" value="">
            </div>

            <div class="setting-group">
                <div class="setting-label">Cloak Page Icon URL</div>
                <input type="text" class="setting-input-field" id="cloakIcon" placeholder="e.g. https://www.google.com/favicon.ico" value="">
            </div>
        </div>
    </div>

    <!-- Games Modal -->
    <div class="modal-overlay" id="gamesModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <span class="modal-title">üéÆ Games</span>
                <button class="modal-close" onclick="closeModal('gamesModal')">‚úï</button>
            </div>

            <div class="games-grid" id="gamesGrid">
                <!-- Games filled by JS -->
            </div>
        </div>
    </div>

    <!-- Proxy Frame -->
    <div class="proxy-frame-container" id="proxyFrameContainer">
        <div class="proxy-navbar">
            <button class="proxy-back-btn" onclick="closeProxy()">‚Üê</button>
            <div class="proxy-url-display" id="proxyUrlDisplay">about:blank</div>
            <button class="proxy-back-btn" onclick="reloadProxy()">‚Üª</button>
        </div>
        <iframe class="proxy-frame" id="proxyFrame" sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-modals" allowfullscreen></iframe>
    </div>

    <script>
        // Particles
        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 40; i++) {
            const particle = document.createElement('div');
            particle.classList.add('particle');
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDuration = (Math.random() * 15 + 10) + 's';
            particle.style.animationDelay = (Math.random() * 15) + 's';
            particle.style.width = (Math.random() * 3 + 1) + 'px';
            particle.style.height = particle.style.width;
            particlesContainer.appendChild(particle);
        }

        // Enter key
        document.getElementById('searchInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                navigateProxy();
            }
        });

        // Games data
        const games = [
            { name: '2048', icon: 'üî¢', url: 'https://play2048.co/' },
            { name: 'Slope', icon: '‚õ∑Ô∏è', url: 'https://slope-game.github.io/' },
            { name: 'Tetris', icon: 'üü¶', url: 'https://tetris.com/play-tetris' },
            { name: 'Pac-Man', icon: 'üü°', url: 'https://www.google.com/logos/2010/pacman10-i.html' },
            { name: 'Snake', icon: 'üêç', url: 'https://playsnake.org/' },
            { name: 'Minesweeper', icon: 'üí£', url: 'https://minesweeperonline.com/' },
            { name: 'Chess', icon: '‚ôüÔ∏è', url: 'https://www.chess.com/play' },
            { name: 'Sudoku', icon: '9Ô∏è‚É£', url: 'https://sudoku.com/' },
            { name: 'Flappy Bird', icon: 'üê¶', url: 'https://flappybird.io/' },
            { name: 'Cookie Clicker', icon: 'üç™', url: 'https://orteil.dashnet.org/cookieclicker/' },
            { name: 'Wordle', icon: 'üìù', url: 'https://www.nytimes.com/games/wordle/index.html' },
            { name: 'Crossy Road', icon: 'üêî', url: 'https://crossyroad.com/' },
            { name: 'Doodle Jump', icon: 'üü©', url: 'https://doodlejump.io/' },
            { name: 'Run 3', icon: 'üèÉ', url: 'https://run3.io/' },
            { name: 'Retro Bowl', icon: 'üèà', url: 'https://retrobowl.org/' },
            { name: 'Subway Surf', icon: 'üõπ', url: 'https://subway-surfers.me/' },
        ];

        // Populate games
        const gamesGrid = document.getElementById('gamesGrid');
        games.forEach(game => {
            const card = document.createElement('div');
            card.className = 'game-card';
            card.innerHTML = `<span class="game-icon">${game.icon}</span><span class="game-name">${game.name}</span>`;
            card.onclick = () => {
                closeModal('gamesModal');
                openInProxy(game.url);
            };
            gamesGrid.appendChild(card);
        });

        // Search engines
        const searchEngines = {
            google: 'https://www.google.com/search?q=',
            bing: 'https://www.bing.com/search?q=',
            duckduckgo: 'https://duckduckgo.com/?q=',
            brave: 'https://search.brave.com/search?q='
        };

        function isUrl(str) {
            const urlPattern = /^(https?:\/\/)?([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}(\/.*)?$/;
            return urlPattern.test(str.trim());
        }

        function navigateProxy() {
            const input = document.getElementById('searchInput').value.trim();
            if (!input) return;

            let url;
            if (isUrl(input)) {
                url = input.startsWith('http') ? input : 'https://' + input;
            } else {
                const engine = document.getElementById('searchEngine').value;
                url = searchEngines[engine] + encodeURIComponent(input);
            }

            openInProxy(url);
        }

        function openInProxy(url) {
            const loadingBar = document.getElementById('loadingBar');
            loadingBar.style.display = 'block';
            loadingBar.style.width = '30%';

            // Use alloy/public proxy services for demo
            const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
            
            const frame = document.getElementById('proxyFrame');
            const container = document.getElementById('proxyFrameContainer');
            const urlDisplay = document.getElementById('proxyUrlDisplay');

            urlDisplay.textContent = url;
            frame.src = url;

            setTimeout(() => {
                loadingBar.style.width = '70%';
            }, 200);

            setTimeout(() => {
                loadingBar.style.width = '100%';
                container.classList.add('active');
                setTimeout(() => {
                    loadingBar.style.display = 'none';
                    loadingBar.style.width = '0%';
                }, 300);
            }, 500);
        }

        function closeProxy() {
            const container = document.getElementById('proxyFrameContainer');
            const frame = document.getElementById('proxyFrame');
            container.classList.remove('active');
            frame.src = 'about:blank';
        }

        function reloadProxy() {
            const frame = document.getElementById('proxyFrame');
            frame.src = frame.src;
        }

        // Modal functions
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
        }

        function openGames() {
            document.getElementById('gamesModal').classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Helper function to update favicon
        function updateFavicon(iconUrl) {
            // Remove existing favicons
            const existingIcons = document.querySelectorAll("link[rel*='icon']");
            existingIcons.forEach(icon => icon.remove());
            
            // Add new favicon
            const link = document.createElement('link');
            link.type = 'image/x-icon';
            link.rel = 'shortcut icon';
            link.href = iconUrl;
            document.head.appendChild(link);
        }

        // Toggle switch with improved favicon handling
        function toggleSwitch(el) {
            el.classList.toggle('active');

            // Tab cloaking
            if (el.id === 'tabCloak' && el.classList.contains('active')) {
                const title = document.getElementById('cloakTitle').value || 'Google Classroom';
                const iconUrl = document.getElementById('cloakIcon').value.trim();
                document.title = title;
                if (iconUrl) {
                    updateFavicon(iconUrl);
                }
            } else if (el.id === 'tabCloak') {
                document.title = 'Desritory';
                // Optionally reset to default icon or remove it
            }
        }

        // Panic key
        document.addEventListener('keydown', function(e) {
            if (e.key === '`' && document.getElementById('panicKey').classList.contains('active')) {
                window.location.href = 'https://classroom.google.com';
            }
        });

        // Tab cloak title listener
        document.getElementById('cloakTitle').addEventListener('input', function() {
            if (document.getElementById('tabCloak').classList.contains('active')) {
                document.title = this.value || 'Google Classroom';
            }
        });

        // Tab cloak icon listener - FIXED VERSION
        document.getElementById('cloakIcon').addEventListener('input', function() {
            const iconUrl = this.value.trim();
            if (iconUrl) {
                updateFavicon(iconUrl);
            }
        });

        // Escape to close modals
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
                closeProxy();
            }
        });

        // Focus search on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('searchInput').focus();
            }, 300);
        });
    </script>
</body>
</html>
