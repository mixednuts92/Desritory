<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desritory V3</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #7c4dff;
    --secondary: #9333ea;
    --accent: #a855f7;
    --light: #c084fc;
    --glow: rgba(120,70,220,0.4);
    --particle-color-1: rgba(124,77,255,0.8);
    --particle-color-2: rgba(168,85,247,0.6);
}

body {
    font-family:'Inter',sans-serif;
    background:linear-gradient(135deg,#1a2332 0%,rgba(124,77,255,0.09) 50%,#1a2332 100%);
    color:white;
    overflow-x:hidden;
    min-height:100vh;
    transition:background 0.5s ease;
}

.time-display {
    position:fixed;
    top:20px;
    left:50%;
    transform:translateX(-50%);
    font-size:18px;
    font-weight:500;
    color:rgba(255,255,255,0.95);
    z-index:1000;
    letter-spacing:0.5px;
    text-shadow:0 2px 8px rgba(0,0,0,0.3);
}

.system-panel {
    position:fixed;
    bottom:30px;
    left:30px;
    background:rgba(20,25,35,0.85);
    backdrop-filter:blur(20px);
    border:1px solid rgba(255,255,255,0.15);
    border-radius:16px;
    padding:20px 25px;
    z-index:1000;
    box-shadow:0 10px 40px rgba(0,0,0,0.5);
    min-width:280px;
    transition:all 0.3s ease;
}

.system-panel:hover {
    border-color:rgba(255,255,255,0.25);
    box-shadow:0 15px 50px rgba(0,0,0,0.6);
}

.system-panel-header {
    font-size:14px;
    font-weight:700;
    color:rgba(255,255,255,0.5);
    margin-bottom:15px;
    letter-spacing:2px;
    text-transform:uppercase;
    border-bottom:1px solid rgba(255,255,255,0.1);
    padding-bottom:10px;
}

.system-stat {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
    font-size:14px;
}

.system-stat:last-child {
    margin-bottom:0;
}

.system-stat-label {
    color:rgba(255,255,255,0.6);
    font-weight:500;
}

.system-stat-value {
    color:rgba(255,255,255,0.95);
    font-weight:600;
    font-family:'Courier New',monospace;
}

.status-indicator {
    display:inline-block;
    width:8px;
    height:8px;
    border-radius:50%;
    background:#10b981;
    margin-right:6px;
    animation:pulse 2s ease-in-out infinite;
    box-shadow:0 0 10px #10b981;
}

@keyframes pulse {
0%,
100% {
    opacity:1;
    transform:scale(1)
}

50% {
    opacity:0.6;
    transform:scale(0.9)
}

}

.system-stat-value.status {
    color:#10b981
}

.system-stat-value.users {
    color:var(--accent)
}

.system-stat-value.theme {
    color:var(--light)
}

.system-stat-value.version {
    color:#60a5fa
}

.system-stat-value.uptime {
    color:#fbbf24
}

.container {
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    padding:40px 20px 20px;
    position:relative;
    z-index:1;
}

#particleCanvas {
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    pointer-events:none;
    z-index:0;
}

@keyframes floatLogo {
0%,
100% {
    transform:translateY(0px)
}

50% {
    transform:translateY(-20px)
}

}

.typing-text {
    font-family:'Inter',sans-serif;
    font-size:24px;
    font-weight:400;
    color:rgba(255,255,255,0.65);
    margin-bottom:40px;
    min-height:32px;
    text-align:center;
    text-shadow:0 2px 6px rgba(0,0,0,0.2);
}

.logo {
    font-family:'Poppins',sans-serif;
    font-size:90px;
    font-weight:900;
    letter-spacing:4px;
    background:linear-gradient(135deg,var(--light) 0%,var(--primary) 25%,var(--accent) 50%,var(--secondary) 75%,var(--light) 100%);
    background-size:200% 200%;
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
    animation:gradientShift 8s ease infinite,floatLogo 4s ease-in-out infinite;
    margin-bottom:50px;
}

@keyframes gradientShift {
0%,
100% {
    background-position:0% 50%
}

50% {
    background-position:100% 50%
}

}

.footer {
    position:fixed;
    bottom:30px;
    right:30px;
    font-size:13px;
    color:rgba(255,255,255,0.55);
    letter-spacing:0.3px;
    display:flex;
    flex-direction:column;
    gap:5px;
    align-items:flex-end;
    text-align:right;
    z-index:1;
    text-shadow:0 2px 6px rgba(0,0,0,0.25);
}

.random-text {
    color:rgba(255,255,255,0.6);
    font-weight:400;
    animation:fadeIn 0.5s ease;
}

@keyframes fadeIn {
from {
    opacity:0;
    transform:translateY(10px)
}

to {
    opacity:1;
    transform:translateY(0)
}

}

.corner-buttons {
    position:fixed;
    top:20px;
    right:20px;
    display:flex;
    gap:10px;
    z-index:1000;
}

.corner-btn {
    width:45px;
    height:45px;
    background:rgba(0,0,0,0.4);
    border:1px solid rgba(255,255,255,0.12);
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all 0.3s;
    backdrop-filter:blur(10px);
    font-size:18px;
    position:relative;
    color:rgba(255,255,255,0.7);
}

.corner-btn:hover {
    background:rgba(255,255,255,0.12);
    border-color:rgba(255,255,255,0.2);
    transform:translateY(-2px);
}

.notification-badge {
    position:absolute;
    top:-6px;
    right:-6px;
    min-width:22px;
    height:22px;
    background:linear-gradient(135deg,#ff3b30,#ff453a);
    border:2px solid #1a2332;
    border-radius:11px;
    color:white;
    font-size:11px;
    font-weight:700;
    display:none;
    align-items:center;
    justify-content:center;
    padding:0 6px;
    box-shadow:0 2px 8px rgba(255,59,48,0.6);
    animation:notifPulse 2s ease-in-out infinite;
}

.notification-badge.active {
    display:flex;
}

@keyframes notifPulse {
0%,
100% {
    transform:scale(1)
}

50% {
    transform:scale(1.1)
}

}

.modal {
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.8);
    backdrop-filter:blur(10px);
    z-index:10001;
    align-items:center;
    justify-content:center;
    padding:20px;
}

.modal.active {
    display:flex;
}

@keyframes modalOpen {
from {
    opacity:0;
    transform:scale(0.94) translateY(8px)
}

to {
    opacity:1;
    transform:scale(1) translateY(0)
}

}

@keyframes modalClose {
from {
    opacity:1;
    transform:scale(1) translateY(0)
}

to {
    opacity:0;
    transform:scale(0.94) translateY(8px)
}

}

.modal-content {
    background:rgba(20,25,35,0.95);
    border:1px solid rgba(255,255,255,0.15);
    border-radius:20px;
    padding:30px;
    max-width:500px;
    width:100%;
    max-height:80vh;
    overflow-y:auto;
    box-shadow:0 20px 60px rgba(0,0,0,0.5);
    backdrop-filter:blur(20px);
    transition:background 0.3s,border-color 0.3s;
    animation:modalOpen 0.18s cubic-bezier(0.34,1.4,0.64,1);
}

.modal-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
}

.modal-title {
    font-size:24px;
    font-weight:700;
    color:rgba(255,255,255,0.9);
}

.close-btn {
    background:none;
    border:none;
    color:white;
    font-size:28px;
    cursor:pointer;
    opacity:0.6;
    transition:opacity 0.3s;
}

.close-btn:hover {
    opacity:1;
}

.settings-section {
    margin-bottom:25px;
}

.settings-label {
    font-size:14px;
    font-weight:600;
    margin-bottom:12px;
    opacity:0.9;
}

.theme-selector {
    width:100%;
    padding:12px 16px;
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:12px;
    color:white;
    font-size:14px;
    font-family:'Inter',sans-serif;
    cursor:pointer;
    transition:all 0.3s;
    outline:none;
}

.theme-selector:hover {
    background:rgba(255,255,255,0.12);
    border-color:rgba(255,255,255,0.3)
}

.theme-selector:focus {
    border-color:var(--primary);
    box-shadow:0 0 0 3px var(--glow)
}

.theme-selector option {
    background:#1e2837;
    color:white
}

.toggle-option {
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:16px 18px;
    background:rgba(255,255,255,0.08);
    border-radius:12px;
    margin-bottom:12px;
    border:1px solid rgba(255,255,255,0.1);
    transition:all 0.3s;
}

.toggle-option:hover {
    background:rgba(255,255,255,0.12);
    border-color:rgba(255,255,255,0.15)
}

.toggle-switch {
    position:relative;
    width:50px;
    height:26px;
    background:rgba(255,255,255,0.2);
    border-radius:13px;
    cursor:pointer;
    transition:background 0.3s;
}

.toggle-switch.active {
    background:var(--primary)
}

.toggle-slider {
    position:absolute;
    top:3px;
    left:3px;
    width:20px;
    height:20px;
    background:white;
    border-radius:50%;
    transition:transform 0.3s;
}

.toggle-switch.active .toggle-slider {
    transform:translateX(24px)
}

.dashboard-btn {
    position:fixed;
    top:20px;
    left:20px;
    width:45px;
    height:45px;
    background:rgba(0,0,0,0.4);
    border:1px solid rgba(255,255,255,0.12);
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all 0.3s;
    backdrop-filter:blur(10px);
    font-size:18px;
    color:rgba(255,255,255,0.7);
    z-index:10003;
}

.dashboard-btn:hover {
    background:rgba(255,255,255,0.12);
    border-color:rgba(255,255,255,0.2);
    transform:translateY(-2px)
}

.dashboard-sidebar {
    position:fixed;
    top:0;
    left:-300px;
    width:300px;
    height:100%;
    background:rgba(20,25,35,0.95);
    backdrop-filter:blur(20px);
    z-index:10002;
    transition:left 0.3s ease,background 0.3s,border-color 0.3s;
    border-right:1px solid rgba(255,255,255,0.15);
    overflow-y:auto;
    padding:80px 20px 20px;
    box-shadow:10px 0 30px rgba(0,0,0,0.5);
}

.dashboard-sidebar.active {
    left:0
}

.dashboard-overlay {
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    backdrop-filter:blur(5px);
    z-index:10001;
    display:none;
    opacity:0;
    transition:opacity 0.3s;
}

.dashboard-overlay.active {
    display:block;
    opacity:1
}

.dashboard-header {
    font-size:24px;
    font-weight:700;
    color:rgba(255,255,255,0.9);
    margin-bottom:30px;
    padding-bottom:15px;
    border-bottom:1px solid rgba(255,255,255,0.1);
}

.dashboard-menu-item {
    padding:18px 20px;
    margin-bottom:12px;
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.1);
    border-radius:14px;
    cursor:pointer;
    transition:all 0.3s;
    display:flex;
    align-items:center;
    gap:15px;
    color:rgba(255,255,255,0.85);
}

.dashboard-menu-item:hover {
    background:rgba(255,255,255,0.12);
    border-color:rgba(255,255,255,0.2);
    transform:translateX(5px);
    box-shadow:0 5px 20px rgba(0,0,0,0.3)
}

.dashboard-menu-item i {
    font-size:20px;
    width:30px;
    text-align:center;
    color:var(--primary)
}

.dashboard-menu-item .item-text {
    flex:1
}

.dashboard-menu-item .item-label {
    font-weight:600;
    font-size:16px;
    margin-bottom:3px
}

.dashboard-menu-item .item-desc {
    font-size:12px;
    opacity:0.6
}

.games-page {
    display:none;
    position:fixed;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:rgb(20,25,35);
    z-index:9999;
    overflow-y:auto;
    transition:background 0.3s;
}

.games-page.active {
    display:block
}

.games-header {
    position:sticky;
    top:0;
    background:rgba(20,25,35,0.98);
    backdrop-filter:blur(20px);
    border-bottom:1px solid rgba(255,255,255,0.12);
    padding:20px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:15px;
    z-index:100;
    box-shadow:0 5px 20px rgba(0,0,0,0.3);
    transition:background 0.3s,border-color 0.3s;
}

.back-btn {
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.15);
    padding:10px 20px;
    border-radius:8px;
    color:rgba(255,255,255,0.85);
    cursor:pointer;
    transition:all 0.3s;
    font-size:14px;
    margin-left:75px;
}

.back-btn:hover {
    background:rgba(255,255,255,0.12);
    border-color:rgba(255,255,255,0.25)
}

.games-title {
    font-size:24px;
    font-weight:700;
    color:rgba(255,255,255,0.9)
}

.games-search {
    flex:1;
    max-width:400px;
    padding:10px 20px;
    background:rgba(255,255,255,0.05);
    border:1px solid rgba(255,255,255,0.15);
    border-radius:8px;
    color:white;
    font-size:14px;
    outline:none;
    transition:all 0.3s;
}

.games-search:focus {
    border-color:rgba(255,255,255,0.3);
    background:rgba(255,255,255,0.08)
}

.games-search::placeholder {
    color:rgba(255,255,255,0.4)
}

.games-list {
    padding:20px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:15px;
}

.game-item {
    display:flex;
    align-items:center;
    gap:20px;
    padding:20px;
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.1);
    border-radius:14px;
    cursor:pointer;
    transition:all 0.3s;
}

.game-item:hover {
    background:rgba(255,255,255,0.12);
    border-color:rgba(255,255,255,0.2);
    transform:translateY(-3px);
    box-shadow:0 8px 25px rgba(0,0,0,0.4)
}

.game-icon {
    min-width:60px;
    width:60px;
    height:60px;
    text-align:center;
    display:flex;
    align-items:center;
    justify-content:center
}

.game-icon img {
    width:100%;
    height:100%;
    object-fit:contain;
    border-radius:10px
}

.game-info {
    flex:1
}

.game-name {
    font-size:18px;
    font-weight:600;
    margin-bottom:5px
}

.game-category {
    font-size:12px;
    opacity:0.6
}

.loading-screen {
    display:none;
    position:fixed;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:rgba(20,25,35,0.98);
    backdrop-filter:blur(10px);
    z-index:10002;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    gap:30px;
}

.loading-screen.active {
    display:flex
}

.loader {
    width:60px;
    height:60px;
    border:4px solid rgba(255,255,255,0.1);
    border-top-color:var(--primary);
    border-radius:50%;
    animation:spin 1s linear infinite
}

@keyframes spin {
to {
    transform:rotate(360deg)
}

}

.loading-text {
    font-size:24px;
    font-weight:700;
    color:rgba(255,255,255,0.9)
}

.proxy-page {
    display:none;
    position:fixed;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:rgb(20,25,35);
    z-index:9999;
    overflow-y:auto;
    transition:background 0.3s
}

.proxy-page.active {
    display:flex;
    flex-direction:column
}

.chat-message {
    padding:12px 16px;
    margin-bottom:12px;
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.1);
    border-radius:12px;
    animation:slideIn 0.3s ease;
    position:relative;
    transition:all 0.3s
}

.chat-message:hover {
    background:rgba(255,255,255,0.12);
    border-color:rgba(255,255,255,0.15)
}

.chat-message:hover .chat-actions {
    opacity:1
}

.chat-actions {
    position:absolute;
    top:5px;
    right:10px;
    opacity:0;
    transition:opacity 0.2s
}

.chat-action-btn {
    background:rgba(255,255,255,0.1);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:5px;
    padding:4px 8px;
    font-size:11px;
    color:white;
    cursor:pointer;
    transition:all 0.2s
}

.chat-action-btn:hover {
    background:var(--primary)
}

.chat-reply-indicator {
    background:rgba(124,77,255,0.2);
    border-left:3px solid var(--primary);
    padding:5px 10px;
    margin-bottom:5px;
    border-radius:5px;
    font-size:12px;
    color:rgba(255,255,255,0.7)
}

.chat-reply-indicator strong {
    color:var(--primary)
}

.replying-to-bar {
    display:none;
    background:rgba(124,77,255,0.15);
    border-left:3px solid var(--primary);
    padding:8px 12px;
    margin-bottom:10px;
    border-radius:5px;
    font-size:13px;
    position:relative
}

.replying-to-bar.active {
    display:block
}

.cancel-reply {
    position:absolute;
    right:10px;
    top:50%;
    transform:translateY(-50%);
    background:none;
    border:none;
    color:white;
    cursor:pointer;
    font-size:16px;
    opacity:0.6;
    transition:opacity 0.2s
}

.cancel-reply:hover {
    opacity:1
}

.chat-message-username {
    font-weight:600;
    color:var(--primary);
    margin-bottom:5px;
    font-size:13px
}

.chat-message-text {
    color:rgba(255,255,255,0.9);
    font-size:14px;
    word-wrap:break-word
}

.chat-message-image {
    max-width:100%;
    max-height:300px;
    border-radius:10px;
    margin-top:10px;
    cursor:pointer;
    transition:transform 0.2s
}

.chat-message-image:hover {
    transform:scale(1.02)
}

.chat-message-time {
    font-size:11px;
    color:rgba(255,255,255,0.4);
    margin-top:5px
}

@keyframes slideIn {
from {
    opacity:0;
    transform:translateY(10px)
}

to {
    opacity:1;
    transform:translateY(0)
}

}

.chat-status {
    text-align:center;
    padding:10px;
    font-size:12px;
    color:rgba(255,255,255,0.5);
    margin-bottom:10px
}

.chat-status.connected {
    color:#10b981
}

.chat-status.error {
    color:#ef4444
}

.chat-input-container {
    display:flex;
    gap:10px;
    align-items:center
}

.chat-input-container input:disabled,
.chat-input-container button:disabled,
.chat-input-container label.disabled {
    opacity:0.5;
    cursor:not-allowed;
    pointer-events:none
}

.image-upload-btn {
    width:40px;
    height:40px;
    background:rgba(255,255,255,0.05);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all 0.3s;
    color:white
}

.image-upload-btn:hover {
    background:rgba(255,255,255,0.1);
    border-color:var(--primary)
}

#imageInput {
    display:none
}

.image-preview {
    display:none;
    max-width:150px;
    max-height:100px;
    border-radius:10px;
    margin-top:10px;
    position:relative
}

.image-preview.active {
    display:block
}

.remove-image {
    position:absolute;
    top:-5px;
    right:-5px;
    background:var(--primary);
    border:none;
    border-radius:50%;
    width:20px;
    height:20px;
    color:white;
    cursor:pointer;
    font-size:12px;
    display:flex;
    align-items:center;
    justify-content:center
}

.typing-indicator {
    display:none;
    padding:8px 12px;
    margin-bottom:10px;
    background:rgba(255,255,255,0.05);
    border-radius:10px;
    font-size:12px;
    color:rgba(255,255,255,0.6);
    font-style:italic
}

.typing-indicator.active {
    display:block
}

.typing-dots {
    display:inline-block;
    margin-left:5px
}

.typing-dots span {
    display:inline-block;
    width:4px;
    height:4px;
    margin:0 2px;
    background:var(--primary);
    border-radius:50%;
    animation:typingDot 1.4s infinite
}

.typing-dots span:nth-child(2) {
    animation-delay:0.2s
}

.typing-dots span:nth-child(3) {
    animation-delay:0.4s
}

@keyframes typingDot {
0%,
60%,
100% {
    opacity:0.3;
    transform:translateY(0)
}

30% {
    opacity:1;
    transform:translateY(-4px)
}

}

.spam-warning {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) scale(0.9);
    background:rgba(239,68,68,0.95);
    border:2px solid #dc2626;
    border-radius:15px;
    padding:30px 40px;
    z-index:10003;
    box-shadow:0 10px 40px rgba(239,68,68,0.5);
    opacity:0;
    pointer-events:none;
    transition:all 0.3s
}

.spam-warning.active {
    opacity:1;
    transform:translate(-50%,-50%) scale(1);
    pointer-events:all
}

.spam-warning-text {
    font-size:20px;
    font-weight:700;
    color:white;
    text-align:center;
    text-shadow:0 2px 4px rgba(0,0,0,0.3)
}

.slur-warning {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) scale(0.9);
    background:rgba(20,25,35,0.98);
    border:2px solid var(--primary);
    border-radius:20px;
    padding:35px 45px;
    z-index:10010;
    box-shadow:0 10px 50px rgba(124,77,255,0.4);
    opacity:0;
    pointer-events:none;
    transition:all 0.3s;
    text-align:center;
    min-width:320px
}

.slur-warning.active {
    opacity:1;
    transform:translate(-50%,-50%) scale(1);
    pointer-events:all
}

.slur-warning-icon {
    font-size:40px;
    margin-bottom:15px
}

.slur-warning-title {
    font-size:22px;
    font-weight:700;
    color:white;
    margin-bottom:10px
}

.slur-warning-text {
    font-size:15px;
    color:rgba(255,255,255,0.7);
    margin-bottom:15px;
    line-height:1.5
}

.slur-warning-timer {
    font-size:32px;
    font-weight:900;
    color:var(--primary);
    font-family:'Courier New',monospace
}

.name-request-modal {
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.85);
    backdrop-filter:blur(10px);
    z-index:10020;
    align-items:center;
    justify-content:center;
    padding:20px
}

.name-request-modal.active {
    display:flex
}

.name-request-content {
    background:rgba(20,25,35,0.98);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:20px;
    padding:35px;
    max-width:420px;
    width:100%;
    box-shadow:0 20px 60px rgba(0,0,0,0.6);
    text-align:center
}

.name-request-title {
    font-size:22px;
    font-weight:700;
    color:rgba(255,255,255,0.95);
    margin-bottom:15px
}

.name-request-text {
    font-size:15px;
    color:rgba(255,255,255,0.65);
    margin-bottom:25px;
    line-height:1.6
}

.name-request-text strong {
    color:var(--primary)
}

.name-request-buttons {
    display:flex;
    gap:12px;
    justify-content:center
}

.name-req-btn {
    padding:12px 30px;
    border-radius:10px;
    border:none;
    font-size:15px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s;
    font-family:'Inter',sans-serif
}

.name-req-btn.allow {
    background:var(--primary);
    color:white
}

.name-req-btn.allow:hover {
    opacity:0.85;
    transform:translateY(-2px)
}

.name-req-btn.deny {
    background:rgba(255,255,255,0.1);
    color:rgba(255,255,255,0.8);
    border:1px solid rgba(255,255,255,0.2)
}

.name-req-btn.deny:hover {
    background:rgba(239,68,68,0.3);
    border-color:#ef4444;
    transform:translateY(-2px)
}

.name-waiting-overlay {
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.85);
    backdrop-filter:blur(10px);
    z-index:10020;
    align-items:center;
    justify-content:center;
    padding:20px
}

.name-waiting-overlay.active {
    display:flex
}

.name-waiting-content {
    background:rgba(20,25,35,0.98);
    border:1px solid rgba(255,255,255,0.15);
    border-radius:20px;
    padding:40px;
    max-width:380px;
    width:100%;
    text-align:center
}

.name-waiting-spinner {
    width:50px;
    height:50px;
    border:3px solid rgba(255,255,255,0.1);
    border-top-color:var(--primary);
    border-radius:50%;
    animation:spin 1s linear infinite;
    margin:0 auto 20px
}

.name-waiting-title {
    font-size:20px;
    font-weight:700;
    color:rgba(255,255,255,0.9);
    margin-bottom:10px
}

.name-waiting-text {
    font-size:14px;
    color:rgba(255,255,255,0.55);
    line-height:1.6
}

.se-btn {
    padding:10px 18px;
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.15);
    border-radius:10px;
    color:rgba(255,255,255,0.7);
    font-size:14px;
    font-family:'Inter',sans-serif;
    cursor:pointer;
    transition:all 0.3s
}

.se-btn:hover {
    background:rgba(255,255,255,0.12);
    color:white
}

.se-btn.active {
    background:var(--primary);
    border-color:var(--primary);
    color:white
}

@media(max-width:768px) {
.logo {
    font-size:48px
}

.system-panel {
    left:15px;
    bottom:15px;
    min-width:240px;
    padding:15px 20px
}

.system-stat {
    font-size:12px;
    margin-bottom:10px
}

.games-header {
    flex-wrap:wrap
}

.games-search {
    width:100%;
    max-width:none
}

.games-list {
    grid-template-columns:1fr
}

.time-display {
    font-size:16px
}

.footer {
    bottom:15px;
    right:15px
}

}

    </style>
</head>
<body>
<div class="time-display" id="timeDisplay">12:00 AM</div>
<canvas id="particleCanvas"></canvas>

<div class="system-panel">
    <div class="system-panel-header">System Panel</div>
    <div class="system-stat"><span class="system-stat-label">Status</span><span class="system-stat-value status"><span class="status-indicator"></span>Online</span></div>
    <div class="system-stat"><span class="system-stat-label">Users Active</span><span class="system-stat-value users" id="usersActive">--</span></div>
    <div class="system-stat"><span class="system-stat-label">Theme</span><span class="system-stat-value theme" id="currentTheme">Slate</span></div>
    <div class="system-stat"><span class="system-stat-label">Version</span><span class="system-stat-value version">3.5.0</span></div>
    <div class="system-stat"><span class="system-stat-label">Uptime</span><span class="system-stat-value uptime" id="uptimeDisplay">00:00:00</span></div>
</div>

<button class="dashboard-btn" onclick="toggleDashboard()"><i class="fas fa-bars"></i></button>
<div class="dashboard-overlay" id="dashboardOverlay" onclick="closeDashboard()"></div>
<div class="dashboard-sidebar" id="dashboardSidebar">
    <div class="dashboard-header">Dashboard</div>
    <div class="dashboard-menu-item" onclick="openProxyFromDashboard()"><i class="fas fa-shield-alt"></i><div class="item-text"><div class="item-label">Desritory Proxy</div><div class="item-desc">Browse the web freely</div></div></div>
    <div class="dashboard-menu-item" onclick="openGamesFromDashboard()"><i class="fas fa-gamepad"></i><div class="item-text"><div class="item-label">Games</div><div class="item-desc">Browse and play games</div></div></div>
    <div class="dashboard-menu-item" onclick="openAppsFromDashboard()"><i class="fas fa-th"></i><div class="item-text"><div class="item-label">Apps</div><div class="item-desc">Explore applications</div></div></div>
    <div class="dashboard-menu-item" onclick="openSettingsFromDashboard()"><i class="fas fa-cog"></i><div class="item-text"><div class="item-label">Settings</div><div class="item-desc">Customize your experience</div></div></div>
    <div class="dashboard-menu-item" onclick="toggleStealthMode()"><i class="fas fa-user-secret"></i><div class="item-text"><div class="item-label">Stealth Mode</div><div class="item-desc">Toggle stealth mode</div></div></div>
</div>

<div class="corner-buttons">
    <button class="corner-btn" onclick="openChat()"><i class="fas fa-comments"></i><span class="notification-badge" id="chatNotificationBadge">0</span></button>
    <button class="corner-btn" onclick="openLatestUpdate()"><i class="fas fa-bell"></i></button>
</div>

<div class="container">
    <h1 class="logo">DESRITORY V3</h1>
    <div class="typing-text" id="typingText"></div>
    <div class="footer">
        <span class="random-text" id="randomText"></span>
        <div style="display:flex;align-items:center;gap:10px;margin-top:5px;"><span>v3.5.0</span><span style="color:rgba(255,255,255,0.2);">|</span><span>¬©2025 Desritory</span></div>
    </div>
</div>

<!-- Settings Modal -->
<div class="modal" id="settingsModal">
    <div class="modal-content">
        <div class="modal-header"><h2 class="modal-title">Settings</h2><button class="close-btn" onclick="closeSettings()">√ó</button></div>
        <div class="settings-section"><div class="settings-label">Theme</div>
            <select class="theme-selector" id="themeSelector" onchange="changeTheme(this.value)">
                <option value="purple">Purple</option><option value="green">Green</option><option value="blue">Blue</option><option value="red">Red</option><option value="pink">Pink</option><option value="spooky">Spooky</option><option value="sky">Sky</option><option value="yellow">Yellow</option><option value="galaxy">Galaxy</option><option value="blackwhite">Slate</option>
            </select>
        </div>
        <div class="settings-section"><div class="settings-label">Search Engine</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <button class="se-btn active" id="se-google" onclick="setSearchEngine('google',this)">Google</button>
                <button class="se-btn" id="se-bing" onclick="setSearchEngine('bing',this)">Bing</button>
                <button class="se-btn" id="se-ddg" onclick="setSearchEngine('ddg',this)">DuckDuckGo</button>
                <button class="se-btn" id="se-yahoo" onclick="setSearchEngine('yahoo',this)">Yahoo</button>
                <button class="se-btn" id="se-brave" onclick="setSearchEngine('brave',this)">Brave</button>
            </div>
        </div>
        <div class="settings-section"><div class="settings-label">Tab Cloaking</div><div class="toggle-option"><span>Enable Tab Cloaking</span><div class="toggle-switch" id="cloakToggle" onclick="toggleCloak()"><div class="toggle-slider"></div></div></div></div>
        <div class="settings-section"><div class="settings-label">Panic Key (' key)</div><div class="toggle-option"><span>Enable Panic Key</span><div class="toggle-switch" id="panicToggle" onclick="togglePanic()"><div class="toggle-slider"></div></div></div></div>
        <div class="settings-section"><div class="settings-label">Optional Settings</div><div class="toggle-option"><span>Show Particles</span><div class="toggle-switch active" id="particlesToggle" onclick="toggleParticles()"><div class="toggle-slider"></div></div></div></div>
    </div>
</div>

<!-- Latest Update Modal -->
<div class="modal" id="latestUpdateModal">
    <div class="modal-content" style="max-width:450px;">
        <div class="modal-header"><h2 class="modal-title">Latest Update</h2><button class="close-btn" onclick="closeLatestUpdate()">√ó</button></div>
        <div style="text-align:center;margin-bottom:20px;">
            <div style="font-size:32px;font-weight:700;color:var(--primary);margin-bottom:10px;">v3.5.0</div>
            <div style="font-size:16px;font-weight:600;color:rgba(255,255,255,0.8);margin-bottom:20px;">What's new in this update</div>
            <div style="font-size:14px;color:rgba(255,255,255,0.7);line-height:1.6;text-align:left;background:rgba(255,255,255,0.05);padding:20px;border-radius:10px;">
                ‚Ä¢ yayy v3.5.0<br>‚Ä¢ Finally added a working proxy!!<br>‚Ä¢ To access it, click the dashboard button!<br>‚Ä¢ CHAT UPDATES:<br>‚Ä¢ Added a filter (only for slurs)<br>‚Ä¢ Removed the ability to copy names, only can copy with permission from the user who already has that name<br>‚Ä¢ Added emoji shortcuts (like :sob:)<br>‚Ä¢ thats all, enjoy!
            </div>
        </div>
    </div>
</div>

<!-- Chat Modal -->
<div class="modal" id="chatModal">
    <div class="modal-content" style="max-width:600px;max-height:80vh;display:flex;flex-direction:column;">
        <div class="modal-header"><h2 class="modal-title">Chat Room</h2><button class="close-btn" onclick="closeChat()">√ó</button></div>
        <div class="chat-status" id="chatStatus">Connecting...</div>
        <div id="chatMessages" style="flex:1;overflow-y:auto;padding:15px;background:rgba(0,0,0,0.2);border-radius:10px;margin-bottom:15px;min-height:400px;"></div>
        <div id="typingIndicator" class="typing-indicator"><span id="typingUsers"></span><span class="typing-dots"><span></span><span></span><span></span></span></div>
        <div id="replyingToBar" class="replying-to-bar">Replying to <strong id="replyingToUser"></strong><button class="cancel-reply" onclick="cancelReply()">√ó</button></div>
        <div id="imagePreviewContainer" style="position:relative;display:inline-block;"><img id="imagePreview" class="image-preview"><button class="remove-image" onclick="removeImage()" style="display:none;">√ó</button></div>
        <div class="chat-input-container">
            <label for="imageInput" class="image-upload-btn" title="Upload image"><i class="fas fa-image"></i></label>
            <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
            <input type="text" id="chatInput" placeholder="Type a message... (try :sob: or :heart:)" style="flex:1;padding:12px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.2);border-radius:10px;color:white;font-size:14px;outline:none;" onkeypress="handleChatKeyPress(event)" oninput="handleTyping()">
            <button onclick="sendMessage()" style="padding:12px 30px;background:var(--primary);border:none;border-radius:10px;color:white;font-weight:600;cursor:pointer;transition:all 0.3s;">Send</button>
        </div>
    </div>
</div>

<div class="spam-warning" id="spamWarning"><div class="spam-warning-text" id="spamWarningText">Hey, stop spamming!!</div></div>
<div class="slur-warning" id="slurWarning"><div class="slur-warning-icon">üö´</div><div class="slur-warning-title">Not allowed.</div><div class="slur-warning-text">Sorry, this isn't allowed.</div><div class="slur-warning-timer" id="slurTimer">10</div></div>

<div class="name-request-modal" id="nameRequestModal">
    <div class="name-request-content">
        <div class="name-request-title">Someone wants your name</div>
        <div class="name-request-text"><strong id="nameRequesterDisplay"></strong> wants to use the name <strong id="nameRequestedDisplay"></strong>. Do you allow this?</div>
        <div class="name-request-buttons"><button class="name-req-btn allow" onclick="respondToNameRequest(true)">Allow</button><button class="name-req-btn deny" onclick="respondToNameRequest(false)">Deny</button></div>
    </div>
</div>

<div class="name-waiting-overlay" id="nameWaitingOverlay">
    <div class="name-waiting-content"><div class="name-waiting-spinner"></div><div class="name-waiting-title">Waiting for approval...</div><div class="name-waiting-text" id="nameWaitingText">The user with that name has been notified.</div></div>
</div>

<div class="games-page" id="gamesPage">
    <div class="games-header"><button class="back-btn" onclick="closeGames()">‚Üê Back</button><h2 class="games-title">GAMES</h2><input type="text" class="games-search" id="gamesSearch" placeholder="üîç Search games..."></div>
    <div class="games-list" id="gamesList"></div>
</div>

<div class="games-page" id="appsPage">
    <div class="games-header"><button class="back-btn" onclick="closeApps()">‚Üê Back</button><h2 class="games-title">APPS</h2><input type="text" class="games-search" id="appsSearch" placeholder="üîç Search apps..."></div>
    <div class="games-list" id="appsList"></div>
</div>

<div class="proxy-page" id="proxyPage">
    <div class="games-header" id="proxyBrowserBar" style="display:none;">
        <button onclick="closeProxyBrowser()" style="padding:10px 16px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:8px;color:rgba(255,255,255,0.85);cursor:pointer;font-size:14px;margin-left:75px;white-space:nowrap;">üè† Home</button>
        <div style="display:flex;gap:8px;align-items:center;flex:1;">
            <button onclick="proxyGoBack()" style="padding:10px 14px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:8px;color:rgba(255,255,255,0.85);cursor:pointer;font-size:14px;flex-shrink:0;"><i class="fas fa-arrow-left"></i></button>
            <button onclick="proxyGoForward()" style="padding:10px 14px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:8px;color:rgba(255,255,255,0.85);cursor:pointer;font-size:14px;flex-shrink:0;"><i class="fas fa-arrow-right"></i></button>
            <button onclick="refreshProxy()" style="padding:10px 14px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:8px;color:rgba(255,255,255,0.85);cursor:pointer;font-size:14px;flex-shrink:0;"><i class="fas fa-rotate-right"></i></button>
            <input id="proxyUrlBar" type="text" placeholder="Enter a URL..." onkeypress="handleProxyUrlBar(event)" style="flex:1;padding:10px 16px;background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:white;font-size:14px;outline:none;font-family:'Inter',sans-serif;">
            <button onclick="goToProxyUrl()" style="padding:10px 16px;background:var(--primary);border:none;border-radius:8px;color:white;cursor:pointer;font-size:14px;flex-shrink:0;">Go</button>
        </div>
        <button onclick="closeProxy()" style="padding:10px 20px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:8px;color:rgba(255,255,255,0.85);cursor:pointer;font-size:14px;">‚Üê Exit</button>
    </div>
    <div id="proxyHome" style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:28px;padding:40px 20px;text-align:center;">
        <button onclick="closeProxy()" style="position:absolute;top:20px;left:20px;padding:10px 18px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:8px;color:rgba(255,255,255,0.85);cursor:pointer;font-size:14px;">‚Üê Back</button>
        <div>
            <div style="font-family:'Poppins',sans-serif;font-size:52px;font-weight:900;letter-spacing:3px;background:linear-gradient(135deg,var(--light) 0%,var(--primary) 40%,var(--accent) 100%);background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:gradientShift 6s ease infinite;">Desritory Proxy</div>
            <div style="font-size:18px;color:rgba(255,255,255,0.55);margin-top:8px;letter-spacing:1px;">Welcome to Freedom.</div>
        </div>
        <div style="width:100%;max-width:580px;display:flex;gap:10px;">
            <input id="proxySearchInput" type="text" placeholder="Search or enter a URL..." onkeypress="handleProxySearch(event)" style="flex:1;padding:16px 22px;background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.18);border-radius:12px;color:white;font-size:16px;outline:none;font-family:'Inter',sans-serif;transition:all 0.3s;">
            <button onclick="launchProxy()" style="padding:16px 28px;background:var(--primary);border:none;border-radius:12px;color:white;font-size:16px;font-weight:600;cursor:pointer;">Go</button>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:12px;width:100%;max-width:580px;">
            <div onclick="launchProxyUrl('https://google.com')" style="padding:16px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:14px;cursor:pointer;transition:all 0.3s;display:flex;flex-direction:column;align-items:center;gap:8px;" onmouseover="this.style.background='rgba(255,255,255,0.11)';this.style.transform='translateY(-3px)'" onmouseout="this.style.background='rgba(255,255,255,0.06)';this.style.transform='translateY(0)'"><span style="font-size:26px;">üîç</span><span style="font-size:13px;color:rgba(255,255,255,0.75);">Google</span></div>
            <div onclick="launchProxyUrl('https://youtube.com')" style="padding:16px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:14px;cursor:pointer;transition:all 0.3s;display:flex;flex-direction:column;align-items:center;gap:8px;" onmouseover="this.style.background='rgba(255,255,255,0.11)';this.style.transform='translateY(-3px)'" onmouseout="this.style.background='rgba(255,255,255,0.06)';this.style.transform='translateY(0)'"><span style="font-size:26px;">‚ñ∂Ô∏è</span><span style="font-size:13px;color:rgba(255,255,255,0.75);">YouTube</span></div>
            <div onclick="launchProxyUrl('https://discord.com')" style="padding:16px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:14px;cursor:pointer;transition:all 0.3s;display:flex;flex-direction:column;align-items:center;gap:8px;" onmouseover="this.style.background='rgba(255,255,255,0.11)';this.style.transform='translateY(-3px)'" onmouseout="this.style.background='rgba(255,255,255,0.06)';this.style.transform='translateY(0)'"><span style="font-size:26px;">üí¨</span><span style="font-size:13px;color:rgba(255,255,255,0.75);">Discord</span></div>
            <div onclick="launchProxyUrl('https://github.com')" style="padding:16px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:14px;cursor:pointer;transition:all 0.3s;display:flex;flex-direction:column;align-items:center;gap:8px;" onmouseover="this.style.background='rgba(255,255,255,0.11)';this.style.transform='translateY(-3px)'" onmouseout="this.style.background='rgba(255,255,255,0.06)';this.style.transform='translateY(0)'"><span style="font-size:26px;">üêô</span><span style="font-size:13px;color:rgba(255,255,255,0.75);">Github</span></div>
            <div onclick="launchProxyUrl('https://spotify.com')" style="padding:16px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:14px;cursor:pointer;transition:all 0.3s;display:flex;flex-direction:column;align-items:center;gap:8px;" onmouseover="this.style.background='rgba(255,255,255,0.11)';this.style.transform='translateY(-3px)'" onmouseout="this.style.background='rgba(255,255,255,0.06)';this.style.transform='translateY(0)'"><span style="font-size:26px;">üéµ</span><span style="font-size:13px;color:rgba(255,255,255,0.75);">Spotify</span></div>
            <div onclick="launchProxyUrl('https://twitter.com')" style="padding:16px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:14px;cursor:pointer;transition:all 0.3s;display:flex;flex-direction:column;align-items:center;gap:8px;" onmouseover="this.style.background='rgba(255,255,255,0.11)';this.style.transform='translateY(-3px)'" onmouseout="this.style.background='rgba(255,255,255,0.06)';this.style.transform='translateY(0)'"><span style="font-size:26px;">üê¶</span><span style="font-size:13px;color:rgba(255,255,255,0.75);">Twitter</span></div>
        </div>
    </div>
    <iframe id="proxyIframe" style="width:100%;flex:1;border:none;display:none;background:white;"></iframe>
</div>

<div class="loading-screen" id="loadingScreen"><div class="loader"></div><div class="loading-text" id="loadingText">Loading...</div></div>

    <script type="module">
import  {
    initializeApp
}
from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
import  {
    getDatabase, ref, set, onValue, onDisconnect, serverTimestamp, push, onChildAdded, onChildChanged, onChildRemoved, limitToLast, query, remove, get
}
from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';
const firebaseConfig =  {
    apiKey:"AIzaSyCtWJWMhHL3ZZ8cyG6oYLJLLWRpqLHrdA",authDomain:"desritory-chat.firebaseapp.com",        databaseURL:"https://desritory-chat-default-rtdb.firebaseio.com",projectId:"desritory-chat",        storageBucket:"desritory-chat.firebasestorage.app",messagingSenderId:"799268069839",        appId:"1:799268069839:web:4bcbfa0389603054bf32ba"
};
let isFirebaseInitialized=false,database=null;
let messagesRef,typingRef,presenceRef,activeNamesRef,nameRequestsRef;
try  {
    const app=initializeApp(firebaseConfig);
    database=getDatabase(app);
    messagesRef=ref(database,'messages');
    typingRef=ref(database,'typing');
    presenceRef=ref(database,'presence');
    activeNamesRef=ref(database,'activeNames');
    nameRequestsRef=ref(database,'nameRequests');
    isFirebaseInitialized=true;
    initializePresence();
}
catch(e)  {
    console.error('Firebase error:',e);
    updateChatStatus('error','Firebase not configured');
}
function initializePresence()  {
    if(!isFirebaseInitialized) return;
    const uid='user_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);
    const uRef=ref(database,`presence/${uid}`);
    set(uRef, {
        online:true,lastSeen:serverTimestamp()
    }).catch(()=> {
    });
    onDisconnect(uRef).remove();
    setInterval(()=> {
        if(isFirebaseInitialized) set(uRef, {
            online:true,lastSeen:serverTimestamp()
        }).catch(()=> {
        });
    },30000);
    onValue(ref(database,'presence'),(snap)=> {
        const d=snap.val();
        const el=document.getElementById('usersActive');
        if(el) el.textContent=d?Object.keys(d).length:0;
    });
}
window.firebaseChat =  {
    sendMessage:(username,text,imageUrl=null,replyTo=null)=> {
        if(!isFirebaseInitialized) return Promise.reject();
        const d= {
            username,text,timestamp:serverTimestamp()
        };
        if(imageUrl) d.imageUrl=imageUrl;
        if(replyTo) d.replyTo=replyTo;
        return push(messagesRef,d);
    },        listenToMessages:(cb)=> {
        if(!isFirebaseInitialized) return;
        onChildAdded(query(messagesRef,limitToLast(50)),(snap)=> {
            const m=snap.val();
            m.id=snap.key;
            cb(m);
        });
    },        setTyping:(username,isTyping)=> {
        if(!isFirebaseInitialized) return Promise.reject();
        const r=ref(database,`typing/${username.replace(/[.#$[\]]/g,'_')}`);
        return isTyping?set(r, {
            username,timestamp:serverTimestamp()
        }):remove(r);
    },        listenToTyping:(cb)=> {
        if(!isFirebaseInitialized) return;
        onChildAdded(typingRef,(s)=> {
            const d=s.val();
            if(d)cb(d.username,true);
        });
        onChildChanged(typingRef,(s)=> {
            const d=s.val();
            if(d)cb(d.username,true);
        });
        onChildRemoved(typingRef,(s)=> {
            const d=s.val();
            if(d)cb(d.username,false);
        });
    },        isInitialized:()=>isFirebaseInitialized,        checkNameAvailable:async(name)=> {
        if(!isFirebaseInitialized) return {
            available:true
        };
        const safe=name.replace(/[.#$[\]]/g,'_').toLowerCase();
        const nRef=ref(database,`activeNames/${safe}`);
        const snap=await get(nRef);
        if(!snap.exists()) return {
            available:true
        };
        const d=snap.val();
        if(Date.now()-d.lastSeen>120000) {
            await remove(nRef);
            return {
                available:true
            };
        }
        return {
            available:false,ownerId:d.ownerId
        };
    },        claimName:(name,ownerId)=> {
        if(!isFirebaseInitialized) return Promise.resolve();
        const safe=name.replace(/[.#$[\]]/g,'_').toLowerCase();
        const nRef=ref(database,`activeNames/${safe}`);
        onDisconnect(nRef).remove();
        return set(nRef, {
            ownerId,lastSeen:serverTimestamp(),displayName:name
        });
    },        keepNameAlive:(name,ownerId)=> {
        if(!isFirebaseInitialized) return;
        set(ref(database,`activeNames/${name.replace(/[.#$[\]]/g,'_').toLowerCase()}`), {
            ownerId,lastSeen:serverTimestamp(),displayName:name
        }).catch(()=> {
        });
    },        releaseName:(name)=> {
        if(!isFirebaseInitialized) return;
        remove(ref(database,`activeNames/${name.replace(/[.#$[\]]/g,'_').toLowerCase()}`)).catch(()=> {
        });
    },        sendNameRequest:(reqId,reqTemp,desiredName,targetOwnerId)=> {
        if(!isFirebaseInitialized) return Promise.reject();
        return set(ref(database,`nameRequests/${reqId}`), {
            requesterTemp:reqTemp,desiredName,targetOwnerId,status:'pending',timestamp:serverTimestamp()
        });
    },        listenNameRequest:(reqId,cb)=> {
        if(!isFirebaseInitialized) return;
        onValue(ref(database,`nameRequests/${reqId}`),(s)=> {
            if(s.exists())cb(s.val());
        });
    },        listenForIncomingNameRequests:(ownerId,cb)=> {
        if(!isFirebaseInitialized) return;
        const seen=new Set();
        onValue(nameRequestsRef,(snap)=> {
            snap.forEach((child)=> {
                const d=child.val();
                if(d&&d.targetOwnerId===ownerId&&d.status==='pending'&&!seen.has(child.key)) {
                    seen.add(child.key);
                    cb(child.key,d);
                }
            });
        });
    },        respondToNameRequest:(reqId,approved)=> {
        if(!isFirebaseInitialized) return Promise.reject();
        return set(ref(database,`nameRequests/${reqId}`), {
            status:approved?'approved':'denied',timestamp:serverTimestamp()
        });
    },        cleanupNameRequest:(reqId)=> {
        if(!isFirebaseInitialized) return;
        remove(ref(database,`nameRequests/${reqId}`)).catch(()=> {
        });
    }
};
function updateChatStatus(status,text) {
    const el=document.getElementById('chatStatus');
    if(el) {
        el.className='chat-status '+status;
        el.textContent=text;
    }
}
if(isFirebaseInitialized) updateChatStatus('connected','üü¢ Connected ‚Äî Real-time chat active');
const startTime=Date.now();
setInterval(()=> {
    const ms=Date.now()-startTime;
    const h=Math.floor(ms/3600000);
    const m=Math.floor((ms%3600000)/60000);
    const s=Math.floor((ms%60000)/1000);
    const el=document.getElementById('uptimeDisplay');
    if(el) el.textContent=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
},1000);
    </script>

    <script>
const EMOJI_SHORTCUTS= {
    ':sob:':'üò≠',':cry:':'üò¢',':smile:':'üòä',':laugh:':'üòÇ',':lol:':'üòÇ',':rofl:':'ü§£',':heart:':'‚ù§Ô∏è',':broken_heart:':'üíî',':fire:':'üî•',':100:':'üíØ',':thumbsup:':'üëç',':thumbsdown:':'üëé',':ok:':'üëå',':wave:':'üëã',':clap:':'üëè',':pray:':'üôè',':skull:':'üíÄ',':eyes:':'üëÄ',':thinking:':'ü§î',':shrug:':'ü§∑',':facepalm:':'ü§¶',':wink:':'üòâ',':sunglasses:':'üòé',':cool:':'üòé',':angry:':'üò†',':rage:':'üò§',':sad:':'üòû',':pensive:':'üòî',':shocked:':'üò±',':scream:':'üò±',':sweat:':'üòÖ',':nervous:':'üò¨',':smirk:':'üòè',':tongue:':'üòõ',':kiss:':'üòò',':love:':'ü•∞',':sparkles:':'‚ú®',':star:':'‚≠ê',':rainbow:':'üåà',':sun:':'‚òÄÔ∏è',':moon:':'üåô',':snowflake:':'‚ùÑÔ∏è',':pizza:':'üçï',':burger:':'üçî',':taco:':'üåÆ',':cat:':'üê±',':dog:':'üê∂',':penguin:':'üêß',':frog:':'üê∏',':ghost:':'üëª',':alien:':'üëΩ',':robot:':'ü§ñ',':poop:':'üí©',':clown:':'ü§°',':crown:':'üëë',':gem:':'üíé',':rocket:':'üöÄ',':boom:':'üí•',':party:':'üéâ',':tada:':'üéâ',':music:':'üéµ',':headphones:':'üéß',':coffee:':'‚òï',':gaming:':'üéÆ',':sus:':'üìÆ',':pepe:':'üê∏',':nerd:':'ü§ì',':monocle:':'üßê',':dead:':'üíÄ',':based:':'üòé',':goat:':'üêê',':real:':'üíØ',':cap:':'üß¢',':nocap:':'üíØ'
};
const SLUR_PATTERNS=[/\bn[i!1|]+[g9]+[e3]+r/gi,/\bn[i!1|]+g{2,}/gi,/\bn[i!1|]gg[ae3]/gi,/\bf[a@]+g{2,}[o0]t/gi,/\bf[a@]+g[s$]/gi,/\bfagg?[o0]t/gi,/\bfag\b/gi,/\bk[i!1]+k[e3]/gi,/\bsp[i!1]+c/gi,/\bch[i!1]+nk/gi,/\bw[e3]+tb[a@]+ck/gi,/\bcr[a@]+ck[e3]+r/gi,/\br[e3]+t[a@]+rd/gi,/\bc[o0]+[o0]+n/gi,/\bj[i!1]+gg[a@]+b[o0]+[o0]/gi,/\bs[a@]+ndN[i!1]+gg[e3]+r/gi,/\btr[a@]+nn[yi]/gi,/\bsh[e3]m[a@]+l[e3]/gi,/\bn1gger/gi,/\bn1gg3r/gi,/\br3gg1n\b/gi,/[a-z0-9]nigger/gi,/[a-z0-9]n1gger/gi,/[a-z0-9]n1gg3r/gi,/\bn+[i!1|]+g+[e3]+r+s?\b/gi,/\bn[i!1|]+g{2,}[a@]+\b/gi,/\bn[i!1|]+g[a@]\b/gi,/\bni+g+a+\b/gi,/\bn[i!1|]+g[g]+[e3]+r/gi,/\bn[!1i|]+g{1,}[e3@a]+r/gi,/\bni\.g+[e3]+r/gi,/\bn[-_][i!1|][-_]g[-_]g[-_][e3][-_]r/gi,/\bn[i!1|]+g\s*g\s*[e3]\s*r/gi,/\b[n]+[i1!|]+[g]+[g]+[e3a@]+[r]+\b/gi,/\bniglet/gi,/\bnigl[e3]t/gi,/\bn[i!1]+gnog/gi,/\bnigg(?:er|a|ah|az|uh|ette|ers|as)/gi,/\bn[i!1|]+qq[e3]+r/gi,/\bn[i!1|]+[9g]+[9g]+[e3a@]+[r7]/gi,/[*#$%^&@!]{0,3}n[i!1|]+g+[e3a@]+r[*#$%^&@!]{0,3}/gi,/\bn[^a-z]{0,2}[i!1|][^a-z]{0,2}g[^a-z]{0,2}g[^a-z]{0,2}[e3a@][^a-z]{0,2}r/gi,/\b(ni|n1|n!)(g+|9+)(er|a|ah|3r|4|uh)\b/gi,/\bnword\b/gi,/\bthe\s+n[\s\-]+word/gi,/n[\s\-_.*]+[i!1|][\s\-_.*]+g[\s\-_.*]+g[\s\-_.*]+[e3a@][\s\-_.*]+r/gi,/\bcp\b/gi,/\bc+h+i+l+d+\s*p+o+r+n/gi,/\bchild\s*p[o0]rn/gi,/\bkiddie\s*p[o0]rn/gi,/\bloli(con)?/gi,/\bshota(con)?/gi,/\bpedo(phile)?/gi,/\bp3d[o0]/gi,/\bped[o0]\b/gi,/\bmap\b/gi,/\bminor\s*attract/gi,/\bnambla/gi,/\bc\.p\.\b/gi];
const SEARCH_ENGINES= { google:'https://www.google.com/search?q=%s',bing:'https://www.bing.com/search?q=%s',ddg:'https://duckduckgo.com/?q=%s',yahoo:'https://search.yahoo.com/search?p=%s',brave:'https://search.brave.com/search?q=%s' };
const IMAGES= { jhbetr:'https://i.imgur.com/IZ0wJQb.jpeg',minecraft:'https://i.imgur.com/ppi20I9.png',gd:'https://i.imgur.com/fpc76U0.jpeg',lacey:'https://i.imgur.com/KEYn8gZ.png',ultrakill:'https://i.imgur.com/wgmTwWM.jpeg',epstein:'https://i.imgur.com/OiAiMSl.png',fnaf1:'https://i.imgur.com/11OJGXJ.jpeg',fnaf2:'https://i.imgur.com/OfpGVct.jpeg',fnaf3:'https://i.imgur.com/ZcwnBE4.png',fnaf4:'https://i.imgur.com/Ew1nrVj.png',hollow:'https://i.imgur.com/iaSgADM.jpeg',fnaf4h:'https://i.imgur.com/MvYx18h.png',fnafsister:'https://i.imgur.com/bLD2AQ1.png',fnafpizza:'https://i.imgur.com/xU4nL4x.png',fnafucn:'https://i.imgur.com/uIPUty9.png',people:'https://i.imgur.com/BgcqQ1w.png',gtag:'https://i.imgur.com/LziGRnF.png',bendy:'https://i.imgur.com/N63N7D7.png',alien:'https://i.imgur.com/e0IXj6f.png',sans:'https://i.imgur.com/396NH6D.png',happy:'https://i.imgur.com/0ocMSU3.png',undertale:'https://i.imgur.com/vOKZyyK.png',class:'https://i.imgur.com/4ofYraf.png' };
const games=[
    { name:'JHBETR',icon:IMAGES.jhbetr,url:'https://jhbetr.github.io/',category:'amazing game play it' },
    { name:'Minecraft',icon:IMAGES.minecraft,url:'/games/minecraft.html',category:'minecraft' },
    { name:'Geometry Dash',icon:IMAGES.gd,url:'/games/gdlite/index.html',category:'BROKEN AUDIO' },
    { name:'Lacey Games',icon:IMAGES.lacey,url:'/games/laceygames/index.html',category:'lacey games' },
    { name:'ULTRAKILL',icon:IMAGES.ultrakill,url:'/games/ultrakill/index.html',category:'ultrakill fun' },
    { name:'Five Nights at Epsteins',icon:IMAGES.epstein,url:'/games/epstein.html',category:'Survive Epstein' },
    { name:'FNaF 1',icon:IMAGES.fnaf1,url:'/games/fnaf.html',category:'Fnaf 1' },
    { name:'FNaF 2',icon:IMAGES.fnaf2,url:'/games/fnaf2.html',category:'fnaf 2' },
    { name:'FNaF 3',icon:IMAGES.fnaf3,url:'/games/fnaf3.html',category:'fnaf 3' },
    { name:'Fnaf 4',icon:IMAGES.fnaf4,url:'/games/fnaf4.html',category:'fnaf 4' },
    { name:'Fnaf 4 Halloween Edition',icon:IMAGES.fnaf4h,url:'/games/fnaf4h.html',category:'fnaf 4 scarier' },
    { name:'Fnaf Sister Location',icon:IMAGES.fnafsister,url:'/games/fnafsister.html',category:'scarier scary fnaf' },
    { name:'Fnaf Pizza Game',icon:IMAGES.fnafpizza,url:'/games/fnafpizza.html',category:'pizza scary' },
    { name:'Ultimate Custom Night',icon:IMAGES.fnafucn,url:'/games/fnafucn.html',category:'ultimate custom night' },
    { name:'Class of 09',icon:IMAGES.class,url:'/games/classof09.html',category:'very fun' },
    { name:'Undertale',icon:IMAGES.undertale,url:'/games/UNDERTALE.html',category:'fun game' },
    { name:'Hollow Knight',icon:IMAGES.hollow,url:'/games/hollowknight.html',category:'fire game' },
    { name:'People Playground',icon:IMAGES.people,url:'/games/peopleplayground.html',category:'fun' },
    { name:'Gorilla Tag',icon:IMAGES.gtag,url:'/games/gorillatag.html',category:'gorilla' },
    { name:'Bendy and the Ink Machine',icon:IMAGES.bendy,url:'/games/bendy.html',category:'scary oohh' },
    { name:'Alien Hominid',icon:IMAGES.alien,url:'/games/alienhominid.html',category:'alien game' },
    { name:'Bad Time Simulator',icon:IMAGES.sans,url:'/games/badtimesimulator.html',category:'bad time, simulator?' },
    { name:'Happy Wheels',icon:IMAGES.happy,url:'/games/happywheels.html',category:'gorey' }];
const apps=[
    { name:'YouTube',icon:'https://i.imgur.com/BqC7P4i.png',url:'https://youtube.com',category:'Video streaming' }];
const randomTexts=['sniped','Hi','desritory','gerard your website sucks /j','i <3 geo-dash','Ok thanks','"im gonna shove a shotgun barrel down your throat"','Ok youre welcome'];
const themeNames= {
    purple:'Purple',green:'Green',blue:'Blue',red:'Red',pink:'Pink',spooky:'Spooky',sky:'Sky',yellow:'Yellow',galaxy:'Galaxy',blackwhite:'Slate'
};
const themes= {
    purple: {
        primary:'#7c4dff',secondary:'#9333ea',accent:'#a855f7',light:'#c084fc',glow:'rgba(120,70,220,0.4)',bgBase:'#1a2332',p1:'rgba(124,77,255,0.8)',p2:'rgba(168,85,247,0.6)'
    },green: {
        primary:'#10b981',secondary:'#059669',accent:'#34d399',light:'#6ee7b7',glow:'rgba(16,185,129,0.4)',bgBase:'#1a2e28',p1:'rgba(16,185,129,0.8)',p2:'rgba(52,211,153,0.6)'
    },blue: {
        primary:'#3b82f6',secondary:'#1d4ed8',accent:'#60a5fa',light:'#93c5fd',glow:'rgba(59,130,246,0.4)',bgBase:'#1a2332',p1:'rgba(59,130,246,0.8)',p2:'rgba(96,165,250,0.6)'
    },red: {
        primary:'#ef4444',secondary:'#dc2626',accent:'#f87171',light:'#fca5a5',glow:'rgba(239,68,68,0.4)',bgBase:'#2e1a1a',p1:'rgba(239,68,68,0.8)',p2:'rgba(248,113,113,0.6)'
    },pink: {
        primary:'#ec4899',secondary:'#db2777',accent:'#f472b6',light:'#f9a8d4',glow:'rgba(236,72,153,0.4)',bgBase:'#2e1a28',p1:'rgba(236,72,153,0.8)',p2:'rgba(244,114,182,0.6)'
    },spooky: {
        primary:'#ff6b00',secondary:'#ff8c00',accent:'#ffa500',light:'#ffb347',glow:'rgba(255,107,0,0.4)',bgBase:'#1a0f0a',p1:'rgba(255,107,0,0.8)',p2:'rgba(255,140,0,0.6)'
    },sky: {
        primary:'#38bdf8',secondary:'#0ea5e9',accent:'#7dd3fc',light:'#bae6fd',glow:'rgba(56,189,248,0.4)',bgBase:'#1a2632',p1:'rgba(56,189,248,0.8)',p2:'rgba(125,211,252,0.6)'
    },yellow: {
        primary:'#eab308',secondary:'#ca8a04',accent:'#facc15',light:'#fde047',glow:'rgba(234,179,8,0.4)',bgBase:'#2e2e1a',p1:'rgba(234,179,8,0.8)',p2:'rgba(250,204,21,0.6)'
    },galaxy: {
        primary:'#9333ea',secondary:'#7c3aed',accent:'#a855f7',light:'#c084fc',glow:'rgba(147,51,234,0.4)',bgBase:'#0a0a0f',p1:'rgba(147,51,234,0.8)',p2:'rgba(168,85,247,0.6)'
    },blackwhite: {
        primary:'#888888',secondary:'#666666',accent:'#aaaaaa',light:'#cccccc',glow:'rgba(136,136,136,0.4)',bgBase:'#1a2332',p1:'rgba(136,136,136,0.8)',p2:'rgba(170,170,170,0.6)'
    }
};
function updateTime() {
    const n=new Date();
    let h=n.getHours();
    const m=n.getMinutes();
    const ap=h>=12?'PM':'AM';
    h=h%12||12;
    document.getElementById('timeDisplay').textContent=h+':'+String(m).padStart(2,'0')+' '+ap;
}
updateTime();
setInterval(updateTime,1000);
function getTypingPhrases() {
    const h=new Date().getHours();
    if(h>=0&&h<5)return["you're up late","hi night owl","go to sleep.","you got school in the morning (probably)","why are you awake"];
    else if(h>=7&&h<9)return["you're up early","goodmorning","wow its morning"];
    else return["browse games","desritory","Have fun using Desritory!","Welcome to Freedom.","Hello","Haiiiii :333"];
}
function setTypingText() {
    const p=getTypingPhrases();
    document.getElementById('typingText').textContent=p[Math.floor(Math.random()*p.length)];
}
function setRandomText() {
    document.getElementById('randomText').textContent=randomTexts[Math.floor(Math.random()*randomTexts.length)];
}
function changeTheme(n) {
    const t=themes[n];
    if(!t)return;
    localStorage.setItem('desritory-theme',n);
    document.getElementById('currentTheme').textContent=themeNames[n];
    document.body.style.background=`linear-gradient(135deg,${t.bgBase} 0%,${t.primary}18 50%,${t.bgBase} 100%)`;
    document.documentElement.style.setProperty('--primary',t.primary);
    document.documentElement.style.setProperty('--secondary',t.secondary);
    document.documentElement.style.setProperty('--accent',t.accent);
    document.documentElement.style.setProperty('--light',t.light);
    document.documentElement.style.setProperty('--glow',t.glow);
    document.documentElement.style.setProperty('--particle-color-1',t.p1);
    document.documentElement.style.setProperty('--particle-color-2',t.p2);
    ['gamesPage','appsPage','proxyPage'].forEach(id=> {
        const el=document.getElementById(id);
        if(el)el.style.background=`rgb(${parseInt(t.bgBase.slice(1,3),16)},${parseInt(t.bgBase.slice(3,5),16)},${parseInt(t.bgBase.slice(5,7),16)})`;
    });
    const logo=document.querySelector('.logo');
    if(logo) {
        logo.style.background=`linear-gradient(135deg,${t.light} 0%,${t.primary} 25%,${t.accent} 50%,${t.secondary} 75%,${t.light} 100%)`;
        logo.style.backgroundSize='200% 200%';
        logo.style.webkitBackgroundClip='text';
        logo.style.webkitTextFillColor='transparent';
        logo.style.backgroundClip='text';
    }
    document.querySelectorAll('.modal-content').forEach(m=> {
        m.style.background=`linear-gradient(135deg,${t.bgBase}f2 0%,${t.primary}15 50%,${t.bgBase}f2 100%)`;
        m.style.borderColor=`${t.primary}40`;
    });
    const sb=document.getElementById('dashboardSidebar');
    if(sb) {
        sb.style.background=`linear-gradient(180deg,${t.bgBase}f2 0%,${t.primary}12 50%,${t.bgBase}f2 100%)`;
        sb.style.borderColor=`${t.primary}40`;
    }
    document.querySelectorAll('.games-header').forEach(h=> {
        h.style.background=`linear-gradient(135deg,${t.bgBase}f2 0%,${t.primary}15 50%,${t.bgBase}f2 100%)`;
        h.style.borderColor=`${t.primary}30`;
    });
    const sel=document.getElementById('themeSelector');
    if(sel)sel.value=n;
}
function setSearchEngine(key,btn) {
    localStorage.setItem('desritory-searchengine',key);
    document.querySelectorAll('.se-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
}
function getSearchEngineUrl() {
    return SEARCH_ENGINES[localStorage.getItem('desritory-searchengine')||'google']||SEARCH_ENGINES.google;
}
(function() {
    const s=localStorage.getItem('desritory-searchengine')||'google';
    const b=document.getElementById('se-'+s);
    if(b) {
        document.querySelectorAll('.se-btn').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
    }
})();
function openModal(id) {
    const m=document.getElementById(id);
    m.classList.add('active');
    const c=m.querySelector('.modal-content');
    if(c) {
        c.style.animation='';
        void c.offsetWidth;
        c.style.animation='modalOpen 0.18s cubic-bezier(0.34,1.4,0.64,1)';
    }
}
function closeModal(id) {
    const m=document.getElementById(id);
    const c=m.querySelector('.modal-content');
    if(c) {
        c.style.animation='modalClose 0.15s cubic-bezier(0.4,0,0.6,1) forwards';
        setTimeout(()=> {
            m.classList.remove('active');
            c.style.animation='';
        },150);
    }
    else {
        m.classList.remove('active');
    }
}
function openSettings() {
    openModal('settingsModal');
}
function closeSettings() {
    closeModal('settingsModal');
}
function openLatestUpdate() {
    openModal('latestUpdateModal');
}
function closeLatestUpdate() {
    closeModal('latestUpdateModal');
}
function toggleStealthMode() {
    const cur=localStorage.getItem('desritory-stealth')==='true';
    const nv=!cur;
    localStorage.setItem('desritory-stealth',nv);
    const ss=document.getElementById('stealthStatus');
    if(nv) {
        document.title='Google';
        const fav=document.querySelector("link[rel*='icon']")||document.createElement('link');
        fav.type='image/x-icon';
        fav.rel='shortcut icon';
        fav.href='https://www.google.com/favicon.ico';
        document.getElementsByTagName('head')[0].appendChild(fav);
        if(ss) {
            ss.textContent='Enabled';
            ss.style.color='#10b981';
        }
    }
    else {
        document.title='Desritory V3';
        const fav=document.querySelector("link[rel*='icon']");
        if(fav)fav.href='';
        if(ss) {
            ss.textContent='Disabled';
            ss.style.color='var(--light)';
        }
    }
    closeDashboard();
}
const SCRAMJET_URL='https://scramjet-app-production-a204.up.railway.app';
function closeProxy() {
    document.getElementById('proxyPage').classList.remove('active');
    closeProxyBrowser();
}
function closeProxyBrowser() {
    document.getElementById('proxyBrowserBar').style.display='none';
    document.getElementById('proxyHome').style.display='flex';
    const i=document.getElementById('proxyIframe');
    i.style.display='none';
    i.src='';
}
function launchProxy() {
    const v=document.getElementById('proxySearchInput').value.trim();
    if(!v)return;
    launchProxyUrl(v);
}
function launchProxyUrl(url) {
    let fu=url;
    if(!url.startsWith('http://')&&!url.startsWith('https://')) {
        if(url.includes('.')&&!url.includes(' '))fu='https://'+url;
        else fu=getSearchEngineUrl().replace('%s',encodeURIComponent(url));
    }
    const i=document.getElementById('proxyIframe');
    i.src=`${SCRAMJET_URL}#${encodeURIComponent(fu)}`;
    i.style.display='block';
    document.getElementById('proxyHome').style.display='none';
    document.getElementById('proxyBrowserBar').style.display='flex';
    document.getElementById('proxyUrlBar').value=fu;
}
function handleProxySearch(e) {
    if(e.key==='Enter')launchProxy();
}
function handleProxyUrlBar(e) {
    if(e.key==='Enter')goToProxyUrl();
}
function goToProxyUrl() {
    const v=document.getElementById('proxyUrlBar').value.trim();
    if(v)launchProxyUrl(v);
}
function refreshProxy() {
    const i=document.getElementById('proxyIframe');
    i.src=i.src;
}
function proxyGoBack() {
    document.getElementById('proxyIframe').contentWindow.history.back();
}
function proxyGoForward() {
    document.getElementById('proxyIframe').contentWindow.history.forward();
}
function openProxyFromDashboard() {
    closeDashboard();
    document.querySelector('.dashboard-btn').style.display='none';
    let c=document.getElementById('proxyContainer');
    if(!c) {
        c=document.createElement('div');
        c.id='proxyContainer';
        c.style.cssText='position:fixed;top:0;left:0;right:0;bottom:0;background:#1a2332;z-index:10000;display:flex;flex-direction:column;';
        document.body.appendChild(c);
    }
    c.innerHTML=`<iframe src="${SCRAMJET_URL}" style="width:100%;height:100%;border:none;background:white;"></iframe><button onclick="closeProxyContainer()" style="position:fixed;top:20px;left:20px;width:50px;height:50px;background:rgba(0,0,0,0.8);border:2px solid var(--primary);border-radius:12px;color:white;cursor:pointer;z-index:10001;backdrop-filter:blur(10px);font-size:20px;display:flex;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 5px 20px rgba(0,0,0,0.5);" onmouseover="this.style.background='rgba(124,77,255,0.3)';this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(0,0,0,0.8)';this.style.transform='none'"><i class="fas fa-arrow-left"></i></button>`;
    c.style.display='flex';
}
function closeProxyContainer() {
    const c=document.getElementById('proxyContainer');
    if(c)c.remove();
    document.querySelector('.dashboard-btn').style.display='flex';
}
let username=localStorage.getItem('desritory-username')||'',myOwnerId=localStorage.getItem('desritory-ownerid')||'',isChatOpen=false,messageIds=new Set(),messagesCache= {
},replyingToMessage=null,selectedImageBase64=null,typingTimeout=null,currentlyTypingUsers=new Set(),unreadMessageCount=0,lastReadTimestamp=Date.now(),messageHistory=[],spamWarningCount=0,spamWarningTimeout=null,slurTimeoutId=null,slurTimerInterval=null,nameKeepAliveInterval=null,pendingNameRequestId=null,pendingNameRequestResolve=null,chatListenersAttached=false,bufferedMessages=[],pendingIncomingRequestId=null;
if(!myOwnerId) {
    myOwnerId='owner_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);
    localStorage.setItem('desritory-ownerid',myOwnerId);
}
function updateNotificationBadge() {
    const b=document.getElementById('chatNotificationBadge');
    if(unreadMessageCount>0) {
        b.textContent=unreadMessageCount>99?'99+':unreadMessageCount;
        b.classList.add('active');
    }
    else {
        b.classList.remove('active');
    }
}
async function resolveUsername(name) {
    if(!window.firebaseChat||!window.firebaseChat.isInitialized())return name;
    let r;
    try {
        r=await window.firebaseChat.checkNameAvailable(name);
    }
    catch(e) {
        return name;
    }
    if(r.available) {
        await window.firebaseChat.claimName(name,myOwnerId);
        return name;
    }
    if(r.ownerId===myOwnerId)return name;
    return new Promise(resolve=> {
        pendingNameRequestResolve=resolve;
        const rid='req_'+Date.now()+'_'+Math.random().toString(36).substr(2,6);
        pendingNameRequestId=rid;
        document.getElementById('nameWaitingOverlay').classList.add('active');
        document.getElementById('nameWaitingText').textContent=`Waiting for the current holder of "${name}" to respond...`;
        window.firebaseChat.sendNameRequest(rid,myOwnerId,name,r.ownerId);
        window.firebaseChat.listenNameRequest(rid,d=> {
            if(d.status==='approved') {
                document.getElementById('nameWaitingOverlay').classList.remove('active');
                window.firebaseChat.claimName(name,myOwnerId);
                window.firebaseChat.cleanupNameRequest(rid);
                pendingNameRequestId=null;
                pendingNameRequestResolve=null;
                resolve(name);
            }
            else if(d.status==='denied') {
                document.getElementById('nameWaitingOverlay').classList.remove('active');
                window.firebaseChat.cleanupNameRequest(rid);
                pendingNameRequestId=null;
                pendingNameRequestResolve=null;
                const alt=name+Math.floor(Math.random()*9000+1000);
                alert(`Request denied. You'll be assigned "${alt}" instead.`);
                window.firebaseChat.claimName(alt,myOwnerId);
                resolve(alt);
            }
        });
        setTimeout(()=> {
            if(pendingNameRequestResolve) {
                document.getElementById('nameWaitingOverlay').classList.remove('active');
                window.firebaseChat.cleanupNameRequest(rid);
                pendingNameRequestId=null;
                pendingNameRequestResolve=null;
                const alt=name+Math.floor(Math.random()*9000+1000);
                alert(`No response. You'll be assigned "${alt}" instead.`);
                window.firebaseChat.claimName(alt,myOwnerId);
                resolve(alt);
            }
        },30000);
    });
}
function listenForNameRequests() {
    if(!window.firebaseChat||!window.firebaseChat.isInitialized())return;
    window.firebaseChat.listenForIncomingNameRequests(myOwnerId,(rid,data)=> {
        if(pendingIncomingRequestId)return;
        pendingIncomingRequestId=rid;
        document.getElementById('nameRequesterDisplay').textContent='Someone';
        document.getElementById('nameRequestedDisplay').textContent=data.desiredName;
        document.getElementById('nameRequestModal').classList.add('active');
    });
}
function respondToNameRequest(approved) {
    document.getElementById('nameRequestModal').classList.remove('active');
    if(pendingIncomingRequestId) {
        window.firebaseChat.respondToNameRequest(pendingIncomingRequestId,approved);
        pendingIncomingRequestId=null;
    }
}
function openChat() {
    if(!username) {
        let dn=prompt('Enter your username:');
        if(!dn)dn='Anonymous'+Math.floor(Math.random()*1000);
        if(window.firebaseChat&&window.firebaseChat.isInitialized()) {
            resolveUsername(dn).then(rn=> {
                username=rn;
                localStorage.setItem('desritory-username',username);
                if(nameKeepAliveInterval)clearInterval(nameKeepAliveInterval);
                nameKeepAliveInterval=setInterval(()=> {
                    if(window.firebaseChat&&window.firebaseChat.isInitialized()&&username)window.firebaseChat.keepNameAlive(username,myOwnerId);
                },60000);
                listenForNameRequests();
                openChatModal();
            }).catch(()=> {
                username=dn;
                localStorage.setItem('desritory-username',username);
                openChatModal();
            });
        }
        else {
            username=dn;
            localStorage.setItem('desritory-username',username);
            openChatModal();
        }
        return;
    }
    openChatModal();
}
function openChatModal() {
    isChatOpen=true;
    openModal('chatModal');
    unreadMessageCount=0;
    lastReadTimestamp=Date.now();
    updateNotificationBadge();
    if(window.firebaseChat&&window.firebaseChat.isInitialized()) {
        if(!chatListenersAttached) {
            chatListenersAttached=true;
            window.firebaseChat.listenToMessages(msg=> {
                bufferedMessages.push(msg);
                if(isChatOpen)flushBufferedMessages();
            });
            window.firebaseChat.listenToTyping(handleTypingUpdate);
        }
        else {
            flushBufferedMessages();
        }
    }
    else {
        const s=document.getElementById('chatStatus');
        s.className='chat-status error';
        s.textContent='Chat unavailable';
    }
    setTimeout(()=> {
        const cm=document.getElementById('chatMessages');
        cm.scrollTop=cm.scrollHeight;
    },100);
}
function flushBufferedMessages() {
    const t=bufferedMessages.slice();
    bufferedMessages=[];
    for(const m of t)displayMessage(m);
}
function closeChat() {
    isChatOpen=false;
    closeModal('chatModal');
    cancelReply();
    removeImage();
    lastReadTimestamp=Date.now();
    if(window.firebaseChat&&window.firebaseChat.isInitialized())window.firebaseChat.setTyping(username,false);
}
function handleImageUpload(e) {
    const f=e.target.files[0];
    if(f&&f.type.startsWith('image/')) {
        const r=new FileReader();
        r.onload=ev=> {
            selectedImageBase64=ev.target.result;
            const p=document.getElementById('imagePreview');
            p.src=selectedImageBase64;
            p.classList.add('active');
            document.querySelector('.remove-image').style.display='flex';
        };
        r.readAsDataURL(f);
    }
}
function removeImage() {
    selectedImageBase64=null;
    const p=document.getElementById('imagePreview');
    p.classList.remove('active');
    p.src='';
    document.querySelector('.remove-image').style.display='none';
    document.getElementById('imageInput').value='';
}
function replyToMessage(id,u) {
    replyingToMessage= {
        id,username:u
    };
    document.getElementById('replyingToBar').classList.add('active');
    document.getElementById('replyingToUser').textContent=u;
    document.getElementById('chatInput').focus();
}
function cancelReply() {
    replyingToMessage=null;
    document.getElementById('replyingToBar').classList.remove('active');
}
function handleTyping() {
    if(!window.firebaseChat||!window.firebaseChat.isInitialized())return;
    const i=document.getElementById('chatInput');
    if(typingTimeout)clearTimeout(typingTimeout);
    if(i.value.trim().length>0) {
        window.firebaseChat.setTyping(username,true);
        typingTimeout=setTimeout(()=>window.firebaseChat.setTyping(username,false),3000);
    }
    else {
        window.firebaseChat.setTyping(username,false);
    }
}
function handleTypingUpdate(tu,isTyping) {
    if(tu===username)return;
    if(isTyping)currentlyTypingUsers.add(tu);
    else currentlyTypingUsers.delete(tu);
    const ind=document.getElementById('typingIndicator');
    const uel=document.getElementById('typingUsers');
    if(currentlyTypingUsers.size===0) {
        ind.classList.remove('active');
        return;
    }
    ind.classList.add('active');
    const u=Array.from(currentlyTypingUsers);
    if(u.length===1)uel.textContent=`${u[0]} is typing`;
    else if(u.length===2)uel.textContent=`${u[0]} and ${u[1]} are typing`;
    else uel.textContent=`${u[0]}, ${u[1]}, and ${u.length-2} other${u.length-2>1?'s':''} are typing`;
}
function normalizeText(t) {
    // Step 1: Unicode normalization - decomposes accented/special chars then strips diacritics
    // e.g. "√±" -> "n", "·º∞" -> "i", "‚Ñï" -> "N"
    let s = t.normalize('NFKD').replace(/[\u0300-\u036f]/g, '');

    // Step 2: Map visually similar Unicode chars to ASCII equivalents
    const unicodeMap = {
        // N lookalikes
        '\u04C3': 'n', '\u0576': 'n', '\u057C': 'n', '\u2115': 'n', '\uFF4E': 'n',
        '\u0274': 'n', '\u1D0E': 'n', '\u14B7': 'n',
        // I lookalikes
        '\u0131': 'i', '\u0456': 'i', '\u04CF': 'i', '\u1EC9': 'i', '\u2139': 'i',
        '\uFF49': 'i', '\u0269': 'i', '\u1D09': 'i', '\u026A': 'i', '\u03B9': 'i',
        '\u1FBE': 'i', '\u037A': 'i',
        // G lookalikes
        '\u0261': 'g', '\uFF47': 'g', '\u018D': 'g', '\u1D83': 'g',
        // E lookalikes
        '\u0435': 'e', '\u04BD': 'e', '\u0259': 'e', '\u018E': 'e', '\uFF45': 'e',
        '\u0190': 'e', '\u2107': 'e',
        // R lookalikes
        '\u0433': 'r', '\u0280': 'r', '\uFF52': 'r', '\u1D19': 'r',
        // A lookalikes
        '\u0430': 'a', '\u0251': 'a', '\u0252': 'a', '\uFF41': 'a',
        // O lookalikes
        '\u043E': 'o', '\u0585': 'o', '\uFF4F': 'o', '\u03BF': 'o', '\u0D20': 'o',
        // common Cyrillic used to bypass
        '\u0440': 'r', '\u0441': 'c', '\u0445': 'x', '\u0443': 'u',
    };

    s = s.split('').map(ch => unicodeMap[ch] || ch).join('');

    // Step 3: lowercase and replace common substitutions
    return s.toLowerCase()
        .replace(/[!1|ƒºƒ∫≈Ç]/g, 'i')
        .replace(/[e3¬£‚Ç¨√´√©√™]/g, 'e')
        .replace(/[a@4√†√°√¢√§]/g, 'a')
        .replace(/[o0√≤√≥√¥√∂]/g, 'o')
        .replace(/[s$5¬ß]/g, 's')
        .replace(/[u√º√π√∫]/g, 'u')
        .replace(/[\s\u200b\u200c\u200d\ufeff]+/g, '') // strip spaces + zero-width chars
        .replace(/[.\-_*,]/g, '')
        // Strip emojis so they can't be used as separators (e.g. nü§£iü§£gü§£gü§£eü§£r)
        .replace(/[\u{1F000}-\u{1FFFF}\u{2600}-\u{27BF}\u{1F300}-\u{1F9FF}\u{FE00}-\u{FEFF}]/gu, '');
}
function containsSlur(t) {
    const n=normalizeText(t);
    return SLUR_PATTERNS.some(p=> {
        p.lastIndex=0;
        return p.test(t)||p.test(n);
    });
}
function applyEmojiShortcuts(t) {
    let r=t;
    for(const[s,e]of Object.entries(EMOJI_SHORTCUTS))r=r.replace(new RegExp(s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'gi'),e);
    return r;
}
function checkForSpam(msg) {
    const now=Date.now();
    const tr=msg.trim().toLowerCase();
    messageHistory.push( {
        text:tr,timestamp:now
    });
    messageHistory=messageHistory.filter(m=>now-m.timestamp<3000);
    if(messageHistory.filter(m=>m.text===tr).length>=5) {
        showSpamWarning();
        return true;
    }
    return false;
}
function showSpamWarning() {
    const w=document.getElementById('spamWarning');
    const wt=document.getElementById('spamWarningText');
    const ci=document.getElementById('chatInput');
    const sb=document.querySelector('.chat-input-container button[onclick="sendMessage()"]');
    const ib=document.querySelector('.image-upload-btn');
    if(ci)ci.disabled=true;
    if(sb)sb.disabled=true;
    if(ib)ib.classList.add('disabled');
    spamWarningCount++;
    if(spamWarningCount===1)wt.textContent="Can you please not spam?";
    else if(spamWarningCount===2)wt.textContent="you're very annoying";
    else wt.textContent="what is wrong with you";
    w.classList.add('active');
    if(spamWarningTimeout)clearTimeout(spamWarningTimeout);
    spamWarningTimeout=setTimeout(()=> {
        w.classList.remove('active');
        if(ci)ci.disabled=false;
        if(sb)sb.disabled=false;
        if(ib)ib.classList.remove('disabled');
    },5000);
}
function showSlurWarning() {
    const se=document.getElementById('slurWarning');
    const te=document.getElementById('slurTimer');
    const ci=document.getElementById('chatInput');
    const sb=document.querySelector('.chat-input-container button[onclick="sendMessage()"]');
    const ib=document.querySelector('.image-upload-btn');
    if(ci) {
        ci.value='';
        ci.disabled=true;
    }
    if(sb)sb.disabled=true;
    if(ib)ib.classList.add('disabled');
    let secs=10;
    te.textContent=secs;
    se.classList.add('active');
    if(slurTimerInterval)clearInterval(slurTimerInterval);
    if(slurTimeoutId)clearTimeout(slurTimeoutId);
    slurTimerInterval=setInterval(()=> {
        secs--;
        te.textContent=secs;
        if(secs<=0)clearInterval(slurTimerInterval);
    },1000);
    slurTimeoutId=setTimeout(()=> {
        se.classList.remove('active');
        if(ci)ci.disabled=false;
        if(sb)sb.disabled=false;
        if(ib)ib.classList.remove('disabled');
    },10000);
}
function sendMessage() {
    const i=document.getElementById('chatInput');
    let msg=i.value.trim();
    if(!msg&&!selectedImageBase64)return;
    if(msg&&containsSlur(msg)) {
        showSlurWarning();
        return;
    }
    if(msg)msg=applyEmojiShortcuts(msg);
    if(msg&&checkForSpam(msg))return;
    if(window.firebaseChat&&window.firebaseChat.isInitialized()) {
        const rt=replyingToMessage? {
            id:replyingToMessage.id,username:replyingToMessage.username,text:messagesCache[replyingToMessage.id]?.text||''
        }
        :null;
        window.firebaseChat.setTyping(username,false);
        if(typingTimeout)clearTimeout(typingTimeout);
        window.firebaseChat.sendMessage(username,msg,selectedImageBase64,rt).then(()=> {
            i.value='';
            cancelReply();
            removeImage();
        }).catch(()=>alert('Failed to send message.'));
    }
    else {
        alert('Chat not connected.');
    }
}
function displayMessage(msg) {
    if(messageIds.has(msg.id))return;
    messageIds.add(msg.id);
    messagesCache[msg.id]=msg;
    if(!isChatOpen&&msg.username!==username&&msg.timestamp>lastReadTimestamp) {
        unreadMessageCount++;
        updateNotificationBadge();
        return;
    }
    if(!isChatOpen)return;
    const cm=document.getElementById('chatMessages');
    const sc=cm.scrollHeight-cm.scrollTop-cm.clientHeight<100;
    const d=document.createElement('div');
    d.className='chat-message';
    let rHTML='';
    if(msg.replyTo)rHTML=`<div class="chat-reply-indicator"><strong>@${escapeHtml(msg.replyTo.username)}</strong>: ${escapeHtml((msg.replyTo.text||'').substring(0,50))}${(msg.replyTo.text||'').length>50?'...':''}</div>`;
    let iHTML='';
    if(msg.imageUrl)iHTML=`<img src="${msg.imageUrl}" class="chat-message-image" onclick="window.open('${msg.imageUrl}','_blank')">`;
    d.innerHTML=`<div class="chat-actions"><button class="chat-action-btn" onclick="replyToMessage('${msg.id}','${escapeHtml(msg.username)}')"><i class="fas fa-reply"></i> Reply</button></div>${rHTML}<div class="chat-message-username">${escapeHtml(msg.username)}</div><div class="chat-message-text">${escapeHtml(msg.text||'')}</div>${iHTML}<div class="chat-message-time">${formatTimestamp(msg.timestamp)}</div>`;
    cm.appendChild(d);
    while(cm.children.length>100)cm.removeChild(cm.firstChild);
    if(sc)cm.scrollTop=cm.scrollHeight;
}
function handleChatKeyPress(e) {
    if(e.key==='Enter') {
        e.preventDefault();
        sendMessage();
    }
}
function escapeHtml(t) {
    const d=document.createElement('div');
    d.textContent=t||'';
    return d.innerHTML;
}
function formatTimestamp(ts) {
    if(!ts)return'';
    try {
        return new Date(ts).toLocaleTimeString([], {
            hour:'2-digit',minute:'2-digit'
        });
    }
    catch(e) {
        return'';
    }
}
function toggleCloak() {
    const t=document.getElementById('cloakToggle');
    t.classList.toggle('active');
    const en=t.classList.contains('active');
    localStorage.setItem('desritory-cloak',en);
    if(en) {
        document.title='Google';
        const fav=document.querySelector("link[rel*='icon']")||document.createElement('link');
        fav.type='image/x-icon';
        fav.rel='shortcut icon';
        fav.href='https://www.google.com/favicon.ico';
        document.getElementsByTagName('head')[0].appendChild(fav);
    }
    else {
        document.title='Desritory V3';
    }
}
function togglePanic() {
    const t=document.getElementById('panicToggle');
    t.classList.toggle('active');
    localStorage.setItem('desritory-panic',t.classList.contains('active'));
}
function toggleParticles() {
    const t=document.getElementById('particlesToggle');
    t.classList.toggle('active');
    const en=t.classList.contains('active');
    localStorage.setItem('desritory-particles',en);
    document.getElementById('particleCanvas').style.display=en?'block':'none';
}
function toggleDashboard() {
    document.getElementById('dashboardSidebar').classList.toggle('active');
    document.getElementById('dashboardOverlay').classList.toggle('active');
}
function closeDashboard() {
    document.getElementById('dashboardSidebar').classList.remove('active');
    document.getElementById('dashboardOverlay').classList.remove('active');
}
function openGamesFromDashboard() {
    closeDashboard();
    showGamesPage();
}
function openAppsFromDashboard() {
    closeDashboard();
    showAppsPage();
}
function openSettingsFromDashboard() {
    closeDashboard();
    openSettings();
}
function showGamesPage() {
    const ls=document.getElementById('loadingScreen');
    const sp=Math.random()<1/20;
    document.getElementById('loadingText').textContent=sp?'probably fine':'Loading games...';
    ls.classList.add('active');
    setTimeout(()=> {
        ls.classList.remove('active');
        document.getElementById('gamesPage').classList.add('active');
    },sp?3000:1000);
}
function closeGames() {
    document.getElementById('gamesPage').classList.remove('active');
    document.getElementById('gamesSearch').value='';
    renderGames();
}
function showAppsPage() {
    const ls=document.getElementById('loadingScreen');
    document.getElementById('loadingText').textContent='Loading apps...';
    ls.classList.add('active');
    setTimeout(()=> {
        ls.classList.remove('active');
        document.getElementById('appsPage').classList.add('active');
    },1000);
}
function closeApps() {
    document.getElementById('appsPage').classList.remove('active');
    document.getElementById('appsSearch').value='';
    renderApps();
}
function renderGames(f='') {
    const gl=document.getElementById('gamesList');
    gl.innerHTML='';
    games.filter(g=>g.name.toLowerCase().includes(f.toLowerCase())||g.category.toLowerCase().includes(f.toLowerCase())).forEach(g=> {
        const it=document.createElement('div');
        it.className='game-item';
        it.innerHTML=`<div class="game-icon"><img src="${g.icon}" alt="${g.name}"></div><div class="game-info"><div class="game-name">${g.name}</div><div class="game-category">${g.category}</div></div>`;
        it.onclick=()=>openGame(g.name,g.url);
        gl.appendChild(it);
    });
}
function renderApps(f='') {
    const al=document.getElementById('appsList');
    al.innerHTML='';
    const filt=apps.filter(a=>a.name.toLowerCase().includes(f.toLowerCase())||a.category.toLowerCase().includes(f.toLowerCase()));
    if(!filt.length) {
        al.innerHTML='<div style="text-align:center;padding:40px;color:rgba(255,255,255,0.5);">No apps available yet. Check back soon!</div>';
        return;
    }
    filt.forEach(a=> {
        const it=document.createElement('div');
        it.className='game-item';
        it.innerHTML=`<div class="game-icon"><img src="${a.icon}" alt="${a.name}"></div><div class="game-info"><div class="game-name">${a.name}</div><div class="game-category">${a.category}</div></div>`;
        it.onclick=()=>openApp(a.name,a.url);
        al.appendChild(it);
    });
}
function openGame(n,u) {
    const ls=document.getElementById('loadingScreen');
    document.getElementById('loadingText').textContent=`Loading ${n}...`;
    ls.classList.add('active');
    setTimeout(()=> {
        ls.classList.remove('active');
        showGameIframe(n,u);
    },500);
}
function openApp(n,u) {
    const ls=document.getElementById('loadingScreen');
    document.getElementById('loadingText').textContent=`Loading ${n}...`;
    ls.classList.add('active');
    setTimeout(()=> {
        ls.classList.remove('active');
        showAppIframe(n,u);
    },500);
}
function makeContainer(closeFunc,pageId) {
    document.getElementById(pageId).classList.remove('active');
    document.querySelector('.dashboard-btn').style.display='none';
    let c=document.getElementById('gameContainer');
    if(!c) {
        c=document.createElement('div');
        c.id='gameContainer';
        c.style.cssText='position:fixed;top:0;left:0;right:0;bottom:0;background:#1a2332;z-index:10000;display:flex;flex-direction:column;';
        document.body.appendChild(c);
    }
    return c;
}
function showGameIframe(n,u) {
    const c=makeContainer('closeGameIframe','gamesPage');
    c.innerHTML=`<iframe src="${u}" style="width:100%;height:100%;border:none;background:white;"></iframe><button onclick="closeGameIframe()" style="position:fixed;top:20px;left:20px;width:50px;height:50px;background:rgba(0,0,0,0.8);border:2px solid var(--primary);border-radius:12px;color:white;cursor:pointer;z-index:10001;backdrop-filter:blur(10px);font-size:20px;display:flex;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 5px 20px rgba(0,0,0,0.5);" onmouseover="this.style.background='rgba(124,77,255,0.3)';this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(0,0,0,0.8)';this.style.transform='none'"><i class="fas fa-arrow-left"></i></button>`;
    c.style.display='flex';
}
function showAppIframe(n,u) {
    const c=makeContainer('closeAppIframe','appsPage');
    c.innerHTML=`<iframe src="${u}" style="width:100%;height:100%;border:none;background:white;"></iframe><button onclick="closeAppIframe()" style="position:fixed;top:20px;left:20px;width:50px;height:50px;background:rgba(0,0,0,0.8);border:2px solid var(--primary);border-radius:12px;color:white;cursor:pointer;z-index:10001;backdrop-filter:blur(10px);font-size:20px;display:flex;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 5px 20px rgba(0,0,0,0.5);" onmouseover="this.style.background='rgba(124,77,255,0.3)';this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(0,0,0,0.8)';this.style.transform='none'"><i class="fas fa-arrow-left"></i></button>`;
    c.style.display='flex';
}
function closeGameIframe() {
    const c=document.getElementById('gameContainer');
    if(c)c.remove();
    document.querySelector('.dashboard-btn').style.display='flex';
    document.getElementById('gamesPage').classList.add('active');
}
function closeAppIframe() {
    const c=document.getElementById('gameContainer');
    if(c)c.remove();
    document.querySelector('.dashboard-btn').style.display='flex';
    document.getElementById('appsPage').classList.add('active');
}
function createParticles() {
    const canvas=document.getElementById('particleCanvas');
    const ctx=canvas.getContext('2d');
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;
    window.addEventListener('resize',()=> {
        canvas.width=window.innerWidth;
        canvas.height=window.innerHeight;
    });
    const particles=[];
    const mouse= {
        x:null,y:null,radius:150
    };
    window.addEventListener('mousemove',e=> {
        mouse.x=e.x;
        mouse.y=e.y;
    });
    class Particle {
        constructor() {
            this.x=Math.random()*canvas.width;
            this.y=Math.random()*canvas.height;
            this.size=Math.random()*2+1;
            this.speedX=(Math.random()-0.5)*0.5;
            this.speedY=(Math.random()-0.5)*0.5;
        }
        update() {
            this.x+=this.speedX;
            this.y+=this.speedY;
            if(this.x>canvas.width||this.x<0)this.speedX*=-1;
            if(this.y>canvas.height||this.y<0)this.speedY*=-1;
        }
        draw() {
            ctx.fillStyle='rgba(255,255,255,0.85)';
            ctx.beginPath();
            ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
            ctx.fill();
        }
    }
    for(let i=0;
    i<80;
    i++)particles.push(new Particle());
    function connect() {
        const c1=getComputedStyle(document.documentElement).getPropertyValue('--particle-color-1').trim();
        const c2=getComputedStyle(document.documentElement).getPropertyValue('--particle-color-2').trim();
        const near=new Set();
        for(let a=0;
        a<particles.length;
        a++) {
            if(mouse.x!==null&&mouse.y!==null) {
                const dx=particles[a].x-mouse.x;
                const dy=particles[a].y-mouse.y;
                const dist=Math.sqrt(dx*dx+dy*dy);
                if(dist<mouse.radius) {
                    near.add(a);
                    const op=1-(dist/mouse.radius);
                    ctx.strokeStyle=c2.replace('0.6',String(op*0.75));
                    ctx.lineWidth=1.8;
                    ctx.beginPath();
                    ctx.moveTo(particles[a].x,particles[a].y);
                    ctx.lineTo(mouse.x,mouse.y);
                    ctx.stroke();
                }
            }
        }
        for(let a=0;
        a<particles.length;
        a++) {
            for(let b=a+1;
            b<particles.length;
            b++) {
                if(near.has(a)&&near.has(b)) {
                    const dx=particles[a].x-particles[b].x;
                    const dy=particles[a].y-particles[b].y;
                    const dist=Math.sqrt(dx*dx+dy*dy);
                    if(dist<120) {
                        const op=1-(dist/120);
                        ctx.strokeStyle=c1.replace('0.8',String(op*0.45));
                        ctx.lineWidth=1.3;
                        ctx.beginPath();
                        ctx.moveTo(particles[a].x,particles[a].y);
                        ctx.lineTo(particles[b].x,particles[b].y);
                        ctx.stroke();
                    }
                }
            }
        }
    }
    function animate() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for(const p of particles) {
            p.update();
            p.draw();
        }
        connect();
        requestAnimationFrame(animate);
    }
    animate();
}
document.getElementById('gamesSearch').addEventListener('input',e=>renderGames(e.target.value));
document.getElementById('appsSearch').addEventListener('input',e=>renderApps(e.target.value));
document.addEventListener('keydown',e=> {
    if(e.key==='Escape') {
        closeDashboard();
        closeSettings();
        closeLatestUpdate();
        if(document.getElementById('gamesPage').classList.contains('active'))closeGames();
        if(document.getElementById('appsPage').classList.contains('active'))closeApps();
        if(document.getElementById('proxyPage').classList.contains('active'))closeProxy();
    }
    if(e.key==="'"&&localStorage.getItem('desritory-panic')==='true')window.location.href='https://google.com';
});
createParticles();
setRandomText();
renderGames();
renderApps();
setTypingText();
if(Math.random()<1/10000) {
    const logo=document.querySelector('.logo');
    logo.style.transform='rotate(180deg)';
    logo.style.transition='transform 1s ease';
}
const CURRENT_VERSION='3.5.0';
const savedVersion=localStorage.getItem('desritory-version');
if(savedVersion!==CURRENT_VERSION) {
    const su=localStorage.getItem('desritory-username');
    const so=localStorage.getItem('desritory-ownerid');
    localStorage.clear();
    if(su)localStorage.setItem('desritory-username',su);
    if(so)localStorage.setItem('desritory-ownerid',so);
    localStorage.setItem('desritory-version',CURRENT_VERSION);
}
changeTheme(localStorage.getItem('desritory-theme')||'blackwhite');
if(localStorage.getItem('desritory-stealth')==='true') {
    document.title='Google';
    const fav=document.querySelector("link[rel*='icon']")||document.createElement('link');
    fav.type='image/x-icon';
    fav.rel='shortcut icon';
    fav.href='https://www.google.com/favicon.ico';
    document.getElementsByTagName('head')[0].appendChild(fav);
}
if(localStorage.getItem('desritory-cloak')==='true') {
    document.getElementById('cloakToggle').classList.add('active');
    toggleCloak();
}
if(localStorage.getItem('desritory-panic')==='true')document.getElementById('panicToggle').classList.add('active');
if(localStorage.getItem('desritory-particles')==='false') {
    document.getElementById('particlesToggle').classList.remove('active');
    document.getElementById('particleCanvas').style.display='none';
}
if(username&&window.firebaseChat&&window.firebaseChat.isInitialized()) {
    listenForNameRequests();
    nameKeepAliveInterval=setInterval(()=> {
        if(window.firebaseChat&&window.firebaseChat.isInitialized()&&username)window.firebaseChat.keepNameAlive(username,myOwnerId);
    },60000);
}
window.addEventListener('beforeunload',()=> {
    if(username&&window.firebaseChat&&window.firebaseChat.isInitialized())window.firebaseChat.releaseName(username);
});
document.addEventListener('visibilitychange',()=> {
    if(!window.firebaseChat||!window.firebaseChat.isInitialized()||!username)return;
    if(document.visibilityState==='hidden')window.firebaseChat.releaseName(username);
    if(document.visibilityState==='visible')window.firebaseChat.claimName(username,myOwnerId);
});
    </script>
</body>
</html>
