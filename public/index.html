<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desritory</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #7c4dff;
            --secondary: #9333ea;
            --accent: #a855f7;
            --light: #c084fc;
            --glow: rgba(120, 70, 220, 0.4);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0b1a;
            background-image: 
                radial-gradient(ellipse at 20% 50%, rgba(88, 40, 180, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(60, 20, 140, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 80%, rgba(30, 15, 80, 0.1) 0%, transparent 50%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            transition: background 0.5s ease;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 20px 20px;
            position: relative;
            z-index: 1;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--glow);
            border-radius: 50%;
            opacity: 0.3;
            animation: float 15s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(100px, -100px); }
            50% { transform: translate(-50px, -200px); }
            75% { transform: translate(-150px, -100px); }
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 72px;
            font-weight: 900;
            letter-spacing: 8px;
            background: linear-gradient(135deg, var(--light) 0%, var(--primary) 25%, var(--accent) 50%, var(--secondary) 75%, var(--light) 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 8s ease infinite;
            text-shadow: 0 0 80px var(--glow);
            margin-bottom: 50px;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .games-btn {
            padding: 18px 50px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--primary);
            border-radius: 50px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            letter-spacing: 1px;
            box-shadow: 0 0 20px var(--glow);
        }

        .games-btn:hover {
            background: rgba(124, 77, 255, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 10px 40px var(--glow);
        }

        .footer {
            position: absolute;
            bottom: 20px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .random-text {
            color: var(--primary);
            font-weight: 600;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .corner-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .corner-btn {
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            font-size: 20px;
        }

        .corner-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px var(--glow);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10001;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(20, 20, 40, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--light), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .settings-section {
            margin-bottom: 25px;
        }

        .settings-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            opacity: 0.9;
        }

        .theme-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .theme-btn {
            padding: 12px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .theme-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .toggle-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: var(--primary);
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        .changelog-content {
            max-height: 500px;
            overflow-y: auto;
        }

        .changelog-entry {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .changelog-entry:last-child {
            border-bottom: none;
        }

        .changelog-version {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .changelog-date {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
        }

        .changelog-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .changelog-item {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            padding-left: 5px;
        }

        .chat-message {
            padding: 10px 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            animation: slideIn 0.3s ease;
        }

        .chat-message-username {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 13px;
        }

        .chat-message-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            word-wrap: break-word;
        }

        .chat-message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 5px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-status {
            text-align: center;
            padding: 10px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 10px;
        }

        .chat-status.connected {
            color: #10b981;
        }

        .chat-status.error {
            color: #ef4444;
        }

        .games-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #0a0b1a;
            z-index: 9999;
            overflow-y: auto;
        }

        .games-page.active {
            display: block;
        }

        .games-header {
            position: sticky;
            top: 0;
            background: rgba(10, 11, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            z-index: 100;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
        }

        .games-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--light), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .games-search {
            flex: 1;
            max-width: 400px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
        }

        .games-search:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--glow);
        }

        .games-search::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .games-list {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .game-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 5px 30px var(--glow);
        }

        .game-icon {
            min-width: 60px;
            width: 60px;
            height: 60px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .game-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 10px;
        }

        .game-info {
            flex: 1;
        }

        .game-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .game-category {
            font-size: 12px;
            opacity: 0.6;
        }

        .loading-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 11, 26, 0.98);
            backdrop-filter: blur(10px);
            z-index: 10002;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 30px;
        }

        .loading-screen.active {
            display: flex;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--light), var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 48px;
            }

            .theme-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .games-header {
                flex-wrap: wrap;
            }

            .games-search {
                width: 100%;
                max-width: none;
            }

            .games-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="particles"></div>
    <div class="corner-buttons">
        <button class="corner-btn" onclick="openChat()"><i class="fas fa-comments"></i></button>
        <button class="corner-btn" onclick="openChangelog()"><i class="fas fa-clipboard-list"></i></button>
        <button class="corner-btn" onclick="openSettings()"><i class="fas fa-cog"></i></button>
    </div>
    <div class="container">
        <h1 class="logo">DESRITORY</h1>
        <button class="games-btn" onclick="showGamesPage()"><i class="fas fa-gamepad"></i> Browse Games</button>
        <div class="footer">
            <span>¬©2025 Desritory</span>
            <span class="random-text" id="randomText"></span>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>
            <div class="settings-section">
                <div class="settings-label">Theme</div>
                <div class="theme-buttons">
                    <button class="theme-btn" onclick="changeTheme('purple')" style="background: linear-gradient(135deg, #7c4dff, #9333ea);">Purple</button>
                    <button class="theme-btn" onclick="changeTheme('green')" style="background: linear-gradient(135deg, #10b981, #059669);">Green</button>
                    <button class="theme-btn" onclick="changeTheme('blue')" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">Blue</button>
                    <button class="theme-btn" onclick="changeTheme('red')" style="background: linear-gradient(135deg, #ef4444, #dc2626);">Red</button>
                    <button class="theme-btn" onclick="changeTheme('pink')" style="background: linear-gradient(135deg, #ec4899, #db2777);">Pink</button>
                    <button class="theme-btn" onclick="changeTheme('orange')" style="background: linear-gradient(135deg, #f59e0b, #d97706);">Orange</button>
                    <button class="theme-btn" onclick="changeTheme('cyan')" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">Cyan</button>
                    <button class="theme-btn" onclick="changeTheme('yellow')" style="background: linear-gradient(135deg, #eab308, #ca8a04);">Yellow</button>
                    <button class="theme-btn" onclick="changeTheme('blackwhite')" style="background: linear-gradient(135deg, #666, #222);">B&W</button>
                </div>
            </div>
            <div class="settings-section">
                <div class="settings-label">Tab Cloaking</div>
                <div class="toggle-option">
                    <span>Enable Tab Cloaking</span>
                    <div class="toggle-switch" id="cloakToggle" onclick="toggleCloak()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
            <div class="settings-section">
                <div class="settings-label">Panic Key (' key)</div>
                <div class="toggle-option">
                    <span>Enable Panic Key</span>
                    <div class="toggle-switch" id="panicToggle" onclick="togglePanic()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="changelogModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Updates & Changelog</h2>
                <button class="close-btn" onclick="closeChangelog()">√ó</button>
            </div>
            <div class="changelog-content">
                <div class="changelog-entry">
                    <div class="changelog-version">v0.8.0</div>
                    <div class="changelog-date">February 8, 2026</div>
                    <div class="changelog-items">
                        <div class="changelog-item">added a chatbox</div>
                        <div class="changelog-item">also added undertale which is cool</div>
                        <div class="changelog-item">didnt really add anything else</div>
                        <div class="changelog-item">ok bye</div>
                    </div>
                </div>
                <div class="changelog-entry">
                    <div class="changelog-version">v0.7.0</div>
                    <div class="changelog-date">February 8, 2026</div>
                    <div class="changelog-items">
                        <div class="changelog-item">will add more soon dw</div>
                        <div class="changelog-item">removed proxy cause idk how to make ts work</div>
                        <div class="changelog-item">adding more games</div>
                        <div class="changelog-item">removed browser ui look and replaced it with a more modern ui.</div>
                        <div class="changelog-item">will work on tryna add more smoother loading times</div>
                        <div class="changelog-item">will work on adding a better tab cloaking</div>
                        <div class="changelog-item">removing boring old pre-set games</div>
                        <div class="changelog-item">thats all</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="chatModal">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h2 class="modal-title">Chat Room</h2>
                <button class="close-btn" onclick="closeChat()">√ó</button>
            </div>
            <div class="chat-status" id="chatStatus">Connecting...</div>
            <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 15px; background: rgba(0, 0, 0, 0.2); border-radius: 10px; margin-bottom: 15px; min-height: 400px;">
                <!-- Messages will appear here -->
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="chatInput" placeholder="Type a message..." style="flex: 1; padding: 12px 20px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 10px; color: white; font-size: 14px; outline: none;" onkeypress="handleChatKeyPress(event)">
                <button onclick="sendMessage()" style="padding: 12px 30px; background: var(--primary); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s;">Send</button>
            </div>
        </div>
    </div>

    <div class="games-page" id="gamesPage">
        <div class="games-header">
            <button class="back-btn" onclick="closeGames()">‚Üê Back</button>
            <h2 class="games-title">GAMES</h2>
            <input type="text" class="games-search" id="gamesSearch" placeholder="üîç Search games...">
            <button class="corner-btn" onclick="openSettings()"><i class="fas fa-cog"></i></button>
        </div>
        <div class="games-list" id="gamesList"></div>
    </div>

    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text" id="loadingText">LOADING...</div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getDatabase, ref, push, onChildAdded, limitToLast, query, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCtWJWMhHL3ZZ8cyG6oYLJLLWRpqLHrdA",
            authDomain: "desritory-chat.firebaseapp.com",
            databaseURL: "https://desritory-chat-default-rtdb.firebaseio.com",
            projectId: "desritory-chat",
            storageBucket: "desritory-chat.firebasestorage.app",
            messagingSenderId: "799268069839",
            appId: "1:799268069839:web:4bcbfa0389603054bf32ba"
        };

        // Initialize Firebase
        let app, database, messagesRef;
        let isFirebaseInitialized = false;

        try {
            app = initializeApp(firebaseConfig);
            database = getDatabase(app);
            messagesRef = ref(database, 'messages');
            isFirebaseInitialized = true;
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            updateChatStatus('error', 'Firebase not configured. Please add your config.');
        }

        // Make Firebase functions available globally
        window.firebaseChat = {
            sendMessage: (username, text) => {
                if (!isFirebaseInitialized) return Promise.reject('Firebase not initialized');
                return push(messagesRef, {
                    username: username,
                    text: text,
                    timestamp: serverTimestamp()
                });
            },
            listenToMessages: (callback) => {
                if (!isFirebaseInitialized) return;
                const recentMessages = query(messagesRef, limitToLast(50));
                onChildAdded(recentMessages, (snapshot) => {
                    const message = snapshot.val();
                    callback(message);
                });
            },
            isInitialized: () => isFirebaseInitialized
        };

        function updateChatStatus(status, text) {
            const statusEl = document.getElementById('chatStatus');
            if (statusEl) {
                statusEl.className = 'chat-status ' + status;
                statusEl.textContent = text;
            }
        }

        if (isFirebaseInitialized) {
            updateChatStatus('connected', 'üü¢ Connected - Real-time chat active');
        }
    </script>

    <script>
        const IMAGES = {
            nazi: 'https://i.imgur.com/1570hPk.jpeg', 
            jhbetr: 'https://i.imgur.com/IZ0wJQb.jpeg', 
            minecraft: 'https://i.imgur.com/ppi20I9.png',
            undertale: 'https://i.imgur.com/o0BMz9D.png'
        };

        const games = [
            { name: 'Nazi zombies', icon: IMAGES.nazi, url: 'https://nzp.gay/', category: 'fight nazi zombies' },
            { name: 'JHBETR', icon: IMAGES.jhbetr, url: 'https://jhbetr.github.io/', category: 'amazing game play it' },
            { name: 'Minecraft', icon: IMAGES.minecraft, url: 'https://eaglercraft1-8.github.io/', category: 'minecraft' },
            { name: 'Undertale', icon: IMAGES.undertale, url: 'https://www.autistici.org/burnedprojects/UNDERTALE/', category: 'undertale fun' },
        ];

        const randomTexts = ['Hi', 'desritory', 'gerard your website sucks', 'sniped', 'i <3 geo-dash', 'Ok thanks', '"im gonna shove a shotgun barrel down your throat"', "Ok youre welcome"];

        const themes = {
            purple: { primary: '#7c4dff', secondary: '#9333ea', accent: '#a855f7', light: '#c084fc', glow: 'rgba(120, 70, 220, 0.4)', bgBase: '#0a0b1a', bgGradient1: 'rgba(88, 40, 180, 0.08)', bgGradient2: 'rgba(60, 20, 140, 0.06)', bgGradient3: 'rgba(30, 15, 80, 0.1)' },
            green: { primary: '#10b981', secondary: '#059669', accent: '#34d399', light: '#6ee7b7', glow: 'rgba(16, 185, 129, 0.4)', bgBase: '#0a1a14', bgGradient1: 'rgba(16, 185, 129, 0.08)', bgGradient2: 'rgba(5, 150, 105, 0.06)', bgGradient3: 'rgba(4, 120, 87, 0.1)' },
            blue: { primary: '#3b82f6', secondary: '#1d4ed8', accent: '#60a5fa', light: '#93c5fd', glow: 'rgba(59, 130, 246, 0.4)', bgBase: '#0a0f1a', bgGradient1: 'rgba(59, 130, 246, 0.08)', bgGradient2: 'rgba(29, 78, 216, 0.06)', bgGradient3: 'rgba(30, 58, 138, 0.1)' },
            red: { primary: '#ef4444', secondary: '#dc2626', accent: '#f87171', light: '#fca5a5', glow: 'rgba(239, 68, 68, 0.4)', bgBase: '#1a0a0a', bgGradient1: 'rgba(239, 68, 68, 0.08)', bgGradient2: 'rgba(220, 38, 38, 0.06)', bgGradient3: 'rgba(185, 28, 28, 0.1)' },
            pink: { primary: '#ec4899', secondary: '#db2777', accent: '#f472b6', light: '#f9a8d4', glow: 'rgba(236, 72, 153, 0.4)', bgBase: '#1a0a14', bgGradient1: 'rgba(236, 72, 153, 0.08)', bgGradient2: 'rgba(219, 39, 119, 0.06)', bgGradient3: 'rgba(190, 24, 93, 0.1)' },
            orange: { primary: '#f59e0b', secondary: '#d97706', accent: '#fbbf24', light: '#fcd34d', glow: 'rgba(245, 158, 11, 0.4)', bgBase: '#1a140a', bgGradient1: 'rgba(245, 158, 11, 0.08)', bgGradient2: 'rgba(217, 119, 6, 0.06)', bgGradient3: 'rgba(180, 83, 9, 0.1)' },
            cyan: { primary: '#06b6d4', secondary: '#0891b2', accent: '#22d3ee', light: '#67e8f9', glow: 'rgba(6, 182, 212, 0.4)', bgBase: '#0a1419', bgGradient1: 'rgba(6, 182, 212, 0.08)', bgGradient2: 'rgba(8, 145, 178, 0.06)', bgGradient3: 'rgba(14, 116, 144, 0.1)' },
            yellow: { primary: '#eab308', secondary: '#ca8a04', accent: '#facc15', light: '#fde047', glow: 'rgba(234, 179, 8, 0.4)', bgBase: '#1a1a0a', bgGradient1: 'rgba(234, 179, 8, 0.08)', bgGradient2: 'rgba(202, 138, 4, 0.06)', bgGradient3: 'rgba(161, 98, 7, 0.1)' },
            blackwhite: { primary: '#888888', secondary: '#666666', accent: '#aaaaaa', light: '#cccccc', glow: 'rgba(136, 136, 136, 0.4)', bgBase: '#0a0a0a', bgGradient1: 'rgba(80, 80, 80, 0.08)', bgGradient2: 'rgba(60, 60, 60, 0.06)', bgGradient3: 'rgba(40, 40, 40, 0.1)' }
        };

        function createParticles() {
            const particlesContainer = document.querySelector('.particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        function setRandomText() {
            const randomText = randomTexts[Math.floor(Math.random() * randomTexts.length)];
            document.getElementById('randomText').textContent = randomText;
        }

        function changeTheme(colorName) {
            const theme = themes[colorName];
            if (!theme) return;
            localStorage.setItem('desritory-theme', colorName);
            document.body.style.background = theme.bgBase;
            document.body.style.backgroundImage = `radial-gradient(ellipse at 20% 50%, ${theme.bgGradient1} 0%, transparent 50%), radial-gradient(ellipse at 80% 20%, ${theme.bgGradient2} 0%, transparent 50%), radial-gradient(ellipse at 50% 80%, ${theme.bgGradient3} 0%, transparent 50%)`;
            document.documentElement.style.setProperty('--primary', theme.primary);
            document.documentElement.style.setProperty('--secondary', theme.secondary);
            document.documentElement.style.setProperty('--accent', theme.accent);
            document.documentElement.style.setProperty('--light', theme.light);
            document.documentElement.style.setProperty('--glow', theme.glow);
            const logo = document.querySelector('.logo');
            logo.style.background = `linear-gradient(135deg, ${theme.light} 0%, ${theme.primary} 25%, ${theme.accent} 50%, ${theme.secondary} 75%, ${theme.light} 100%)`;
            logo.style.webkitBackgroundClip = 'text';
            logo.style.webkitTextFillColor = 'transparent';
            logo.style.backgroundClip = 'text';
            const gamesTitle = document.querySelector('.games-title');
            if (gamesTitle) {
                gamesTitle.style.background = `linear-gradient(135deg, ${theme.light}, ${theme.primary})`;
                gamesTitle.style.webkitBackgroundClip = 'text';
                gamesTitle.style.webkitTextFillColor = 'transparent';
                gamesTitle.style.backgroundClip = 'text';
            }
            document.querySelectorAll('.particle').forEach(particle => {
                particle.style.background = theme.glow.replace('0.4', '0.3');
            });
        }

        function openSettings() { document.getElementById('settingsModal').classList.add('active'); }
        function closeSettings() { document.getElementById('settingsModal').classList.remove('active'); }
        function openChangelog() { document.getElementById('changelogModal').classList.add('active'); }
        function closeChangelog() { document.getElementById('changelogModal').classList.remove('active'); }
        
        // Firebase Chat System
        let username = localStorage.getItem('desritory-username') || '';
        let isChatOpen = false;
        let messageIds = new Set();

        function openChat() {
            if (!username) {
                username = prompt('Enter your username:');
                if (!username) {
                    username = 'Anonymous' + Math.floor(Math.random() * 1000);
                }
                localStorage.setItem('desritory-username', username);
            }
            
            isChatOpen = true;
            document.getElementById('chatModal').classList.add('active');
            
            // Set up Firebase listener
            if (window.firebaseChat && window.firebaseChat.isInitialized()) {
                window.firebaseChat.listenToMessages(displayMessage);
            } else {
                document.getElementById('chatStatus').className = 'chat-status error';
                document.getElementById('chatStatus').textContent = 'idk if this works yet';
            }
            
            setTimeout(() => {
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }

        function closeChat() {
            isChatOpen = false;
            document.getElementById('chatModal').classList.remove('active');
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message && message.length > 0) {
                if (window.firebaseChat && window.firebaseChat.isInitialized()) {
                    window.firebaseChat.sendMessage(username, message)
                        .then(() => {
                            input.value = '';
                        })
                        .catch((error) => {
                            console.error('Error sending message:', error);
                            alert('Failed to send message. Please check your Firebase config.');
                        });
                } else {
                    alert('Chat not connected. Please configure Firebase (see console for instructions).');
                }
            }
        }

        function displayMessage(message) {
            if (!isChatOpen) return;
            
            // Create unique ID from timestamp and username
            const msgId = `${message.timestamp}-${message.username}-${message.text}`;
            
            // Prevent duplicate messages
            if (messageIds.has(msgId)) return;
            messageIds.add(msgId);
            
            const chatMessages = document.getElementById('chatMessages');
            const shouldScroll = chatMessages.scrollHeight - chatMessages.scrollTop - chatMessages.clientHeight < 100;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.innerHTML = `
                <div class="chat-message-username">${escapeHtml(message.username)}</div>
                <div class="chat-message-text">${escapeHtml(message.text)}</div>
                <div class="chat-message-time">${formatTimestamp(message.timestamp)}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Keep only last 100 messages in DOM
            while (chatMessages.children.length > 100) {
                chatMessages.removeChild(chatMessages.firstChild);
            }
            
            if (shouldScroll) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatTimestamp(timestamp) {
            if (!timestamp) return '';
            try {
                const date = new Date(timestamp);
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            } catch (e) {
                return '';
            }
        }
        
        function toggleCloak() {
            const toggle = document.getElementById('cloakToggle');
            toggle.classList.toggle('active');
            const enabled = toggle.classList.contains('active');
            localStorage.setItem('desritory-cloak', enabled);
            if (enabled) {
                document.title = 'Google';
                const favicon = document.querySelector("link[rel*='icon']") || document.createElement('link');
                favicon.type = 'image/x-icon';
                favicon.rel = 'shortcut icon';
                favicon.href = 'https://www.google.com/favicon.ico';
                document.getElementsByTagName('head')[0].appendChild(favicon);
            } else {
                document.title = 'Desritory';
            }
        }
        
        function togglePanic() {
            const toggle = document.getElementById('panicToggle');
            toggle.classList.toggle('active');
            localStorage.setItem('desritory-panic', toggle.classList.contains('active'));
        }
        
        function showGamesPage() {
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingText = document.getElementById('loadingText');
            const gamesPage = document.getElementById('gamesPage');
            loadingText.textContent = 'Loading games...';
            loadingScreen.classList.add('active');
            setTimeout(() => {
                loadingScreen.classList.remove('active');
                gamesPage.classList.add('active');
            }, 1000);
        }
        
        function closeGames() {
            document.getElementById('gamesPage').classList.remove('active');
            document.getElementById('gamesSearch').value = '';
            renderGames();
        }
        
        function renderGames(filter = '') {
            const gamesList = document.getElementById('gamesList');
            gamesList.innerHTML = '';
            const filteredGames = games.filter(game => game.name.toLowerCase().includes(filter.toLowerCase()) || game.category.toLowerCase().includes(filter.toLowerCase()));
            filteredGames.forEach(game => {
                const gameItem = document.createElement('div');
                gameItem.className = 'game-item';
                gameItem.innerHTML = `<div class="game-icon"><img src="${game.icon}" alt="${game.name}"></div><div class="game-info"><div class="game-name">${game.name}</div><div class="game-category">${game.category}</div></div>`;
                gameItem.onclick = () => openGame(game.name, game.url);
                gamesList.appendChild(gameItem);
            });
        }
        
        function openGame(name, url) {
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingText = document.getElementById('loadingText');
            loadingText.textContent = `Loading ${name}...`;
            loadingScreen.classList.add('active');
            setTimeout(() => {
                loadingScreen.classList.remove('active');
                showGameIframe(name, url);
            }, 500);
        }

        function showGameIframe(name, url) {
            document.getElementById('gamesPage').classList.remove('active');
            
            let gameContainer = document.getElementById('gameContainer');
            if (!gameContainer) {
                gameContainer = document.createElement('div');
                gameContainer.id = 'gameContainer';
                gameContainer.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: #0a0b1a;
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                `;
                document.body.appendChild(gameContainer);
            }
            
            gameContainer.innerHTML = `
                <div style="background: rgba(10, 11, 26, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding: 15px 20px; display: flex; align-items: center; gap: 15px; z-index: 10001;">
                    <button onclick="closeGameIframe()" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); padding: 10px 20px; border-radius: 10px; color: white; cursor: pointer; font-size: 14px; font-family: 'Inter', sans-serif;">‚Üê Back</button>
                    <h2 style="font-size: 20px; font-weight: 700; background: linear-gradient(135deg, var(--light), var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 0;">${name}</h2>
                    <button onclick="openInNewTab('${url}')" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); padding: 10px 20px; border-radius: 10px; color: white; cursor: pointer; font-size: 14px; font-family: 'Inter', sans-serif; margin-left: auto;">Open in New Tab ‚Üó</button>
                </div>
                <iframe src="${url}" style="flex: 1; width: 100%; border: none; background: white;"></iframe>
            `;
            
            gameContainer.style.display = 'flex';
        }

        function closeGameIframe() {
            const gameContainer = document.getElementById('gameContainer');
            if (gameContainer) {
                gameContainer.style.display = 'none';
            }
            document.getElementById('gamesPage').classList.add('active');
        }

        function openInNewTab(url) {
            window.open(url, '_blank');
        }
        
        document.getElementById('gamesSearch').addEventListener('input', (e) => renderGames(e.target.value));
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSettings();
                closeChangelog();
                closeChat();
                if (document.getElementById('gamesPage').classList.contains('active')) closeGames();
            }
            if (e.key === "'" && localStorage.getItem('desritory-panic') === 'true') window.location.href = 'https://google.com';
        });
        
        createParticles();
        setRandomText();
        renderGames();
        const savedTheme = localStorage.getItem('desritory-theme') || 'blackwhite';
        changeTheme(savedTheme);
        if (localStorage.getItem('desritory-cloak') === 'true') {
            document.getElementById('cloakToggle').classList.add('active');
            toggleCloak();
        }
        if (localStorage.getItem('desritory-panic') === 'true') {
            document.getElementById('panicToggle').classList.add('active');
        }
    </script>
</body>
</html>
